<!DOCTYPE html>
<html lang="fr">
<head>
  <link rel="icon" href="assets/logo-whiteee.png" type="image/png">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Qaouti House – Restaurant , Fast Food & Snack</title>
  <meta name="description" content="Qaouti House – Restaurant , Fast Food & Snack. Situé à Rabat. Commande WhatsApp et sur place." />
  <meta property="og:title" content="Qaouti House – Restaurant , Fast Food & Snack" />
  <meta property="og:description" content="Restaurant , Fast Food & Snack à Rabat. Commande via WhatsApp, téléphone, ou sur place." />
  <meta property="og:type" content="website" />
  <meta property="og:locale" content="fr_MA" />

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Restaurant",
    "name": "Qaouti House",
    "address": {
      "@type": "PostalAddress",
      "streetAddress": "Avenue Al Massira 10052",
      "addressLocality": "Rabat",
      "addressCountry": "MA"
    },
    "telephone": "+212609935865",
    "servesCuisine": ["Fast Food", "Asiatique", "Italienne", "Marocain"],
    "priceRange": "$$",
    "menu": "#menu-unified",
    "openingHoursSpecification": [
      {
        "@type": "OpeningHoursSpecification",
        "dayOfWeek": [
          "Sunday",
          "Monday",
          "Tuesday",
          "Wednesday",
          "Thursday",
          "Friday"
        ],
        "opens": "11:00",
        "closes": "00:45"
      },
      {
        "@type": "OpeningHoursSpecification",
        "dayOfWeek": "Saturday",
        "opens": "11:00",
        "closes": "00:30"
      }
    ]
  }
  </script>

  <script src="https://cdn.tailwindcss.com"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Kaushan+Script&family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <script src="https://unpkg.com/feather-icons"></script>

  <style>

    /* CSS for sticky modal footer */
    .modal-content-wrapper {
      display: flex;
      flex-direction: column;
      height: 100%; /* Make wrapper fill the container height */
    }

    .modal-options-scroll {
      flex: 1 1 auto; /* Allows this area to grow and shrink */
      overflow-y: auto; /* Enables scrolling only for this section */
      padding: 1rem 0;
    }

    .modal-footer-sticky {
      flex-shrink: 0; /* Prevents the footer from shrinking */
      padding-top: 1rem;
      border-top: 1px solid #e2e8f0;
      background-color: white; /* Ensures it's not transparent */
    }
    /* Enhanced Modern Styling */
    .kaushan-script-regular {
      font-family: "Kaushan Script", cursive;
      font-weight: 400;
      font-style: normal;
    }

    .inter-font {
      font-family: "Inter", sans-serif;
    }

    /* Custom CSS Variables */
    :root {
      /* Modern Color Palette */
      --bg-primary: #f8fafc;
      --bg-secondary: #ffffff;
      --surface: #ffffff;
      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --accent-primary: #22c55e;
      --accent-secondary: #16a34a;
      --accent-warning: #f59e0b;
      --accent-error: #ef4444;

      /* Gradients */
      --gradient-primary: linear-gradient(135deg, #22c55e 0%, #16a34a 0%);
      --gradient-hero: linear-gradient(135deg, #1e3b25 0%, #33553a 0%);
      --gradient-card: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);

      /* Shadows */
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
      --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);

      /* Border Radius */
      --radius-sm: 0.375rem;
      --radius-md: 0.5rem;
      --radius-lg: 0.75rem;
      --radius-xl: 1rem;
      --radius-2xl: 1.5rem;

      /* Transitions */
      --transition-fast: 0.15s ease-in-out;
      --transition-normal: 0.3s ease-in-out;
      --transition-slow: 0.5s ease-in-out;
    }

    /* Modern Base Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Inter", sans-serif;
      line-height: 1.6;
      color: var(--text-primary);
      background-color: var(--bg-primary);
      overflow-x: hidden;
    }

    /* Smooth Scrolling */
    html {
      scroll-behavior: smooth;
    }
    
    .menu-section,
    #locations,
    #reviews,
    #promotions,
    #popular {
        scroll-margin-top: 96px; /* tune to header height */
    }

    @media (max-width: 640px) {
    .menu-section,
    #locations,
    #reviews,
    #promotions,
    #popular {
        scroll-margin-top: 84px; /* slightly smaller on mobile if header is shorter */
    }
    }


    /* Hero Section Enhanced */
    .hero-section {
      position: relative;
      min-height: 100vh;
      background: var(--gradient-hero);
      background-image: url('assets/qaouti-storefront.png');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      overflow: hidden;
    }

    .hero-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(39, 83, 42, 0.85) 0%, rgba(52, 153, 56, 0.75) 100%);
      backdrop-filter: blur(1px);
    }

    .hero-content {
      position: relative;
      z-index: 10;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 0 1rem;
    }

        /* --- CSS for Horizontal Scrolling Section (Updated for both sections) --- */
    .horizontal-scroll-container {
      display: flex; /* Lays items out in a single row */
      overflow-x: auto; /* Enables horizontal scrolling */
      gap: 1.5rem; /* The space between your promo cards */
      /* Add padding to the edges of the container */
      padding-left: 1rem;
      padding-right: 1rem;
      padding-bottom: 1.5rem; /* Space for the scrollbar if visible */
      scroll-snap-type: x mandatory; /* Makes scrolling snap to items */
      
      /* Hides the scrollbar for a cleaner look */
      scrollbar-width: none; /* Firefox */
      -ms-overflow-style: none; /* Internet Explorer 10+ */
    }

    .horizontal-scroll-container::-webkit-scrollbar {
      display: none; /* Safari and Chrome */
    }

    /* --- Style for the items inside the scroller (NOW APPLIES TO .promo-card AND .menu-card) --- */
    .horizontal-scroll-container > .promo-card,
    .horizontal-scroll-container > .menu-card {
      flex-shrink: 0; /* Prevents cards from shrinking */
      scroll-snap-align: start; /* Snaps the start of the card to the container */
      width: 90%; /* On mobile, each card takes up 90% of the width */
    }

    /* On medium screens and up, show more cards */
    @media (min-width: 768px) {
      .horizontal-scroll-container > .promo-card,
      .horizontal-scroll-container > .menu-card {
        width: 45%; /* Shows about two cards */
      }
    }

    /* On large screens and up, show more cards */
    @media (min-width: 1024px) {
      .horizontal-scroll-container > .promo-card,
      .horizontal-scroll-container > .menu-card {
        width: 31%; /* Shows about three cards */
      }
    }

    /* Modern Menu Cards */
    .menu-card, .promo-card {
      position: relative;
      background: var(--surface);
      border-radius: var(--radius-2xl);
      overflow: hidden;
      box-shadow: var(--shadow-lg);
      transition: all var(--transition-normal);
      cursor: pointer;
      group: true;
      display: flex;
      flex-direction: column;
    }
        /* --- CSS for Horizontal Scrolling Section --- */
    .horizontal-scroll-container {
      display: flex; /* Lays items out in a single row */
      overflow-x: auto; /* Enables horizontal scrolling */
      gap: 1.5rem; /* The space between your promo cards */
      /* Add padding to the edges of the container */
      padding-left: 1rem;
      padding-right: 1rem;
      padding-bottom: 1.5rem; /* Space for the scrollbar if visible */
      scroll-snap-type: x mandatory; /* Makes scrolling snap to items */
      
      /* Hides the scrollbar for a cleaner look */
      scrollbar-width: none; /* Firefox */
      -ms-overflow-style: none; /* Internet Explorer 10+ */
    }

    .horizontal-scroll-container::-webkit-scrollbar {
      display: none; /* Safari and Chrome */
    }

    /* --- Style for the items inside the scroller --- */
    .horizontal-scroll-container > .promo-card {
      flex-shrink: 0; /* Prevents cards from shrinking */
      scroll-snap-align: start; /* Snaps the start of the card to the container */
      width: 90%; /* On mobile, each card takes up 90% of the width */
    }

    /* On medium screens and up, show more cards */
    @media (min-width: 768px) {
      .horizontal-scroll-container > .promo-card {
        width: 45%; /* Shows about two cards */
      }
    }

    /* On large screens and up, show more cards */
    @media (min-width: 1024px) {
      .horizontal-scroll-container > .promo-card {
        width: 31%; /* Shows about three cards */
      }
    }

    .menu-card:hover, .promo-card:hover {
      transform: translateY(-8px);
      box-shadow: var(--shadow-xl);
    }

    .menu-card-image, .promo-card-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
      transition: transform var(--transition-slow);
    }

    .menu-card:hover .menu-card-image, .promo-card:hover .promo-card-image {
      transform: scale(1.05);
    }

    .menu-card-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 0px;
      background: linear-gradient(to bottom, transparent 0%, rgba(0,0,0,0.1) 100%);
      pointer-events: none;
    }

    .menu-card-content, .promo-card-content {
      position: relative;
      padding: 1.5rem;
      z-index: 5;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
    }

    .menu-card-title, .promo-card-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
      line-height: 1.3;
    }

    
    /* Price container with inline add-to-cart button */
    .menu-card-price-container, .promo-card-price-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: auto;
      padding-top: 0.5rem;
    }

    .menu-card-price, .promo-card-price {
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--accent-primary);
      margin-bottom: 0;
      margin-right: 1rem;
    }

    .add-to-cart-btn-inline {
      width: 2.5rem;
      height: 2.5rem;
      background: var(--gradient-primary);
      border: none;
      border-radius: 50%;
      color: white;
      cursor: pointer;
      transition: all var(--transition-fast);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-md);
      flex-shrink: 0;
    }

    .add-to-cart-btn-inline:hover {
      transform: scale(1.1);
      box-shadow: var(--shadow-lg);
    }

    .add-to-cart-btn-inline svg {
      width: 1rem;
      height: 1rem;
    }

    .menu-card-description, .promo-card-description {
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin-bottom: 1rem;
      line-height: 1.4;
      flex-grow: 1;
    }

    .add-to-cart-btn {
      position: absolute;
      top: 1rem;
      right: 1rem;
      width: 3rem;
      height: 3rem;
      background: var(--gradient-primary);
      border: none;
      border-radius: 50%;
      color: white;
      cursor: pointer;
      transition: all var(--transition-fast);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-md);
      z-index: 10;
    }

    .add-to-cart-btn:hover {
      transform: scale(1.1);
      box-shadow: var(--shadow-lg);
    }

    .add-to-cart-btn svg {
      width: 1.25rem;
      height: 1.25rem;
    }

    /* Modern Filter Buttons */
    .filter-scroll {
      display: flex;
      gap: 0.75rem;
      overflow-x: auto;
      padding: 1rem 0;
      scroll-behavior: smooth;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }
/* Show scrollbars on laptop/desktop for category filter buttons */
  @media (min-width: 1024px) {
    .filter-scroll {
      scrollbar-width: thin;        /* Firefox: show thin scrollbar */
      -ms-overflow-style: scrollbar; /* IE/Edge: show scrollbar */
    }
    
    .filter-scroll::-webkit-scrollbar {
      display: block;               /* Webkit: show scrollbar */
      width: 8px;                   /* scrollbar width */
      height: 8px;                  /* horizontal scrollbar height */
    }
    
    .filter-scroll::-webkit-scrollbar-track {
      background: #f1f9f3;          /* track color (light gray) */
      border-radius: 4px;
    }
    
    .filter-scroll::-webkit-scrollbar-thumb {
      background: #cbd5e1;          /* thumb color (medium gray) */
      border-radius: 4px;
      border: 1px solid #f1f5f9;    /* subtle border */
    }
    
    .filter-scroll::-webkit-scrollbar-thumb:hover {
      background: #94b896;          /* darker on hover */
    }
  }

    .filter-scroll::-webkit-scrollbar {
      display: none;
    }

    .filter-btn {
      /* --- NEW: Added properties for alignment and size --- */
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 110px; /* This sets a minimum width for all buttons */
      flex-shrink: 0;
      padding: 0.75rem 1.5rem;
      border: 2px solid #e2e8f0;
      background: var(--surface);
      border-radius: var(--radius-xl);
      font-weight: 600;
      color: var(--text-secondary);
      cursor: pointer;
      transition: color var(--transition-fast),
                  border-color var(--transition-fast),
                  box-shadow var(--transition-fast),
                  transform var(--transition-fast); 
      white-space: nowrap;
    }

    .filter-btn:hover {
      border-color: var(--accent-primary);
      color: var(--accent-primary);
      transform: translateY(-2px);
    }

    .filter-btn.active:not(.filter-btn-image) {
      background: var(--gradient-primary);
      border-color: var(--accent-primary);
      color: white;
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    /* Menu Section Headers */
    .menu-section-header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .menu-section-title {
      font-size: 2.5rem;
      font-weight: 800;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.5rem;
    }
    .menu-section-items:not(:first-child) {
      margin-top: 2rem; /* 48px of space */
    }
    .menu-section-desc {
      font-size: 1.125rem;
      color: var(--text-secondary);
      max-width: 600px;
      margin: 0 auto;
    }

    /* Enhanced Loading Animation */
    .loading-spinner {
      width: 3rem;
      height: 3rem;
      border: 3px solid #e2e8f0;
      border-top: 3px solid var(--accent-primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
  /* Desktop/laptop: make category filter buttons look like mobile image chips */
  @media (min-width: 641px) {
    .filter-btn-image {
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: flex-start;
      padding: 0.75rem 1rem;       /* similar comfortable padding */
      min-width: 140px;            /* ensure a consistent pill size */
      min-height: 56px;
      color: #fff;                  /* readable on photos */
      border: 0;
      background-color: transparent;/* let the image show */
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      border-radius: var(--radius-xl);
      text-shadow: 0 1px 2px rgba(0,0,0,.45);
      overflow: hidden;             /* contain overlay radius */
    }

    /* Dark overlay for readability over images */
    .filter-btn-image::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      background: linear-gradient(0deg, rgba(0,0,0,.35), rgba(0,0,0,.35));
    }
    .filter-btn-image > span { position: relative; z-index: 1; }

    /* Keep image visible when active; cancel the opaque gradient */
    .filter-btn-image.active {
  /* overrides .filter-btn.active gradient */
      color: #fff;
      border-color: var(--accent-primary);
      box-shadow: var(--shadow-md);
      transform: none;
    }
  }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Modern Header */
    .header-glass {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }

    /* Toast Notification Styling - FIXED */
    .toast {
      position: fixed;
      top: 1rem;
      right: 1rem;
      background: var(--accent-primary);
      color: white;
      padding: 1rem 1.5rem;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-xl);
      z-index: 9999;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      transform: translateX(100%);
      transition: transform var(--transition-normal);
      font-weight: 600;
      min-width: 200px;
    }

    .toast.show {
      transform: translateX(0);
    }

    .toast.error {
      background: var(--accent-error);
    }

    .toast.success {
      background: var(--accent-primary);
    }

    .toast.info {
      background: #3b82f6;
    }

    .toast svg {
      width: 1.25rem;
      height: 1.25rem;
      flex-shrink: 0;
    }

    .toast-message {
      flex: 1;
      font-size: 0.95rem;
    }

    /* Supplements styling */
    .supplements-display {
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px solid #e2e8f0;
    }

    .supplement-item {
      font-size: 0.75rem;
      color: var(--accent-primary);
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    /* Modal styling improvements */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      z-index: 9998;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    .modal-content {
      background: white;
      border-radius: var(--radius-2xl);
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: var(--shadow-xl);
    }

    /* Quantity selector styling */
    .quantity-selector {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin: 1rem 0;
    }

    .quantity-btn {
      width: 2.5rem;
      height: 2.5rem;
      border: 2px solid var(--accent-primary);
      border-radius: 50%;
      background: white;
      color: var(--accent-primary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--transition-fast);
      font-size: 1.2rem;
      font-weight: bold;
    }

    .quantity-btn:hover {
      background: var(--accent-primary);
      color: white;
    }

    .quantity-display {
      font-size: 1.25rem;
      font-weight: 700;
      min-width: 2rem;
      text-align: center;
    }

    /* Choice selection styling */
    .choice-group {
      margin: 1rem 0;
      padding: 1rem;
      border: 1px solid #e2e8f0;
      border-radius: var(--radius-lg);
    }

    .choice-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
      color: var(--text-primary);
    }

    .choice-option {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .choice-option input[type="radio"], 
    .choice-option input[type="checkbox"] {
      width: 1.25rem;
      height: 1.25rem;
      accent-color: var(--accent-primary);
    }

    .choice-option label {
      flex: 1;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .choice-price {
      font-weight: 600;
      color: var(--accent-primary);
    }

    /* Upsell section styling */
    .upsell-section {
      margin-top: 1.5rem;
      padding-top: 1.5rem;
      border-top: 2px solid #e2e8f0;
    }

    .upsell-title {
      font-size: 1.125rem;
      font-weight: 700;
      margin-bottom: 1rem;
      color: var(--text-primary);
    }

    .upsell-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem;
      border: 1px solid #e2e8f0;
      border-radius: var(--radius-md);
      margin-bottom: 0.5rem;
    }

    .upsell-item-info {
      flex: 1;
    }

    .upsell-item-name {
      font-weight: 600;
      color: var(--text-primary);
    }

    .upsell-item-price {
      font-size: 0.875rem;
      color: var(--accent-primary);
      font-weight: 600;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .menu-card, .promo-card {
        height: auto;
      }

      .menu-card-image, .promo-card-image {
        height: 180px;
      }

      .hero-content h1 {
        font-size: 2.5rem;
      }

      .menu-section-title {
        font-size: 2rem;
      }

      .modal-content {
        margin: 1rem;
        max-height: 85vh;
      }
    }

    @media (max-width: 480px) {
      .filter-scroll {
        padding: 0.5rem 0;
      }

      .filter-btn {
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
      }

      .menu-card-content, .promo-card-content {
        padding: 1rem;
      }

      .add-to-cart-btn {
        width: 2.5rem;
        height: 2.5rem;
        top: 0.75rem;
        right: 0.75rem;
      }

    }

@media (max-width: 640px) {
  /* 1) Menu cards: allow growth and proper text wrapping */
  .menu-card, .promo-card {
    height: auto;               /* let it grow with content */
  }
  .menu-card-image, .promo-card-image {
    height: 180px;              /* optional: keep a steady image height on mobile */
    object-fit: cover;
  }
  .menu-card-description, .promo-card-description {
    line-height: 1.4;
    white-space: normal;        /* allow wrapping */
    overflow: visible;
    word-break: break-word;
    overflow-wrap: anywhere;
    margin-bottom: 1rem;        /* keep spacing */
  }

  /* Image-style filter buttons for mobile */
  .filter-btn-image {
    position: relative;
    color: #fff;
    border: 0;
    border-color: transparent;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    text-shadow: 0 1px 2px rgba(0,0,0,.45);
  }

  /* darken just enough for legibility */
  .filter-btn-image::before {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: linear-gradient(0deg, rgba(0,0,0,.35), rgba(0,0,0,.35));
  }

  .filter-btn-image > span { position: relative; z-index: 1; }

  .filter-btn-image.active {
    box-shadow: var(--shadow-md);
    transform: none ;
  }


  /* Mobile/touch: disable fixed backgrounds */
  @media (pointer: coarse) {
    .hero-section { background-attachment: scroll; }
  }

  /* Or a simple width-based override */
  @media (max-width: 1024px) {
    .hero-section { background-attachment: scroll; }
  }

  /* More resilient viewport height on iOS */
  .hero-content { height: 100dvh; min-height: 100vh; }

    /* 1) Never transform image-chip buttons (no move, no scale) */


  /* 2) Keep the image unchanged in all states; do not let background get replaced */
  .filter-btn-image,
  .filter-btn-image.active {
    background-size: cover !important;
    background-position: center !important;
    background-repeat: no-repeat !important;
    /* Only animate safe properties to avoid any “zoom-like” feeling */
    transition-property: color, border-color, box-shadow !important;
  }



  /* 6) Remove the desktop-only transform for image chips (was translateY) */
  @media (min-width: 641px) {
    .filter-btn-image.active {
      /* do NOT set background: none; leave the image intact */
      color: #fff;
      border-color: var(--accent-primary);
      box-shadow: var(--shadow-md);
      transform: none !important;
    }
  }

}
  @media (max-width: 640px) {
          #filter-container {
              position: -webkit-sticky; /* For Safari compatibility */
              position: sticky;
              top: 84px; /* This value should match your header's height on mobile */
              z-index: 40; /* Places it above the content but below the main header */
              background-color: var(--bg-primary); /* Ensures content doesn't show through when scrolling */
              
              /* Adds some padding for a cleaner look when the bar is sticky */
              padding-top: 0.5rem;
              padding-bottom: 0.5rem;
          }
      }

      #filter-container > .relative::after {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        width: 0px; /* Width of the fade effect */
        background: linear-gradient(to right, transparent, var(--bg-primary));
        pointer-events: none; /* Allows clicks to go through the fade effect */
    }
  </style>

</head>

<body class="inter-font">
  <button
    id="adminQuickAccessButton"
    type="button"
    class="fixed bottom-5 right-4 z-50 inline-flex items-center gap-2 rounded-full bg-emerald-500 px-4 py-3 text-sm font-semibold text-white shadow-xl transition-all duration-300 hover:-translate-y-0.5 hover:bg-emerald-600 focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:ring-offset-2 focus:ring-offset-slate-900"
    title="Aller directement au tableau de bord admin"
  >
    <svg class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24" aria-hidden="true">
      <path stroke-linecap="round" stroke-linejoin="round" d="M3 7a2 2 0 012-2h4l2 2h6a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V7z" />
      <path stroke-linecap="round" stroke-linejoin="round" d="M9 13l2 2 4-4" />
    </svg>
    <span class="hidden sm:inline">Accès Admin</span>
    <span class="sm:hidden">Admin</span>
  </button>
  <header class="header-glass fixed top-0 left-0 right-0 z-50 transition-all duration-300">
    <div class="max-w-7xl mx-auto px-4 py-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <img src="assets/logo-white.png" alt="Qaouti House" class="h-12 w-12 ">
          <div>
            <h1 class="text-2xl font-bold kaushan-script-regular text-gray-800">Qaouti House</h1>
            <p class="text-sm text-gray-600">Restaurant & Fast Food</p>
          </div>
        </div>

        <nav class="hidden md:flex items-center gap-8">
          <a href="#hero" class="text-gray-700 hover:text-green-500 font-medium transition-colors duration-300">Accueil</a>
          <a href="#promotions" class="text-gray-700 hover:text-green-500 font-medium transition-colors duration-300">Promos</a>
          <a href="#popular" class="text-gray-700 hover:text-green-500 font-medium transition-colors duration-300">Populaire</a>
          <a href="#menu-unified" class="text-gray-700 hover:text-green-500 font-medium transition-colors duration-300">Menu</a>
          <a href="#locations" class="text-gray-700 hover:text-green-500 font-medium transition-colors duration-300">Adresse</a>
          <a href="#reviews" class="text-gray-700 hover:text-green-500 font-medium transition-colors duration-300">Avis</a>
          <a href="#admin-dashboard" data-admin-link class="text-gray-700 hover:text-green-500 font-medium transition-colors duration-300">Admin</a>
        </nav>

        <div class="flex items-center gap-4">
          <button onclick="openCart()" class="relative p-3 bg-green-500 hover:bg-green-600 text-white rounded-full transition-colors duration-300">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-1.5 6M7 13l-1.5 6m9.5-6v6a2 2 0 01-2 2H9a2 2 0 01-2-2v-6m8 0V9a2 2 0 00-2-2H9a2 2 0 00-2 2v4.01"></path>
            </svg>
            <span id="cartCount" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center">0</span>
          </button>

          <button onclick="toggleMobileMenu()" class="md:hidden p-2 text-gray-700 hover:text-green-500">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
          </button>
        </div>
      </div>

      <nav id="mobileMenu" class="md:hidden mt-4 pb-4 hidden">
        <div class="flex flex-col gap-4">
          <a href="#hero" class="text-gray-700 hover:text-green-500 font-medium transition-colors duration-300">Accueil</a>
          <a href="#promotions" class="text-gray-700 hover:text-green-500 font-medium transition-colors duration-300">Promos</a>
          <a href="#popular" class="text-gray-700 hover:text-green-500 font-medium transition-colors duration-300">Populaire</a>
          <a href="#menu-unified" class="text-gray-700 hover:text-green-500 font-medium transition-colors duration-300">Menu</a>
          <a href="#locations" class="text-gray-700 hover:text-green-500 font-medium transition-colors duration-300">Adresse</a>
          <a href="#reviews" class="text-gray-700 hover:text-green-500 font-medium transition-colors duration-300">Avis</a>
          <a href="#admin-dashboard" data-admin-link class="text-gray-700 hover:text-green-500 font-medium transition-colors duration-300">Admin</a>
        </div>
      </nav>
    </div>
  </header>

  <section id="hero" class="hero-section">
    <div class="hero-overlay"></div>
    <div class="hero-content">
      <div class="text-center text-white max-w-4xl mx-auto">
        <img
        src="assets/logo-whiteee.png"
        alt="Qaouti House"
        width="256"
        height="256"
        class="mx-auto mb-0 h-68 w-68 sm:h-76 sm:w-76 md:h-84 md:w-84 lg:h-92 lg:w-92 object-contain"
        loading="eager"
        decoding="sync"
        />

        <p class="text-lg md:text-xl mb-12 text-gray-300 max-w-2xl mx-auto">
          Savourez l'art de la cuisine à Rabat!
        </p>

        <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
          <a href="#menu-unified" class="bg-green-500 hover:bg-green-600 text-white px-8 py-4 rounded-2xl font-semibold text-lg transition-all duration-300 hover:scale-105 shadow-xl">
            Voir le Menu
          </a>
          <button onclick="leaveReview()" class="bg-white/20 hover:bg-white/30 backdrop-blur-sm text-white border-2 border-white/30 px-8 py-4 rounded-2xl font-semibold text-lg transition-all duration-300 hover:scale-105">
            Laisser un avis
          </button>
          <a href="#admin-dashboard" data-admin-link class="inline-flex items-center gap-3 rounded-2xl border-2 border-white/40 bg-white/10 px-8 py-4 text-lg font-semibold text-white transition-all duration-300 hover:-translate-y-0.5 hover:border-white/70 hover:bg-white/20">
            <svg class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 11c1.657 0 3-1.343 3-3S13.657 5 12 5 9 6.343 9 8s1.343 3 3 3z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M19 20v-2a4 4 0 00-4-4H9a4 4 0 00-4 4v2" />
            </svg>
            Espace Admin
          </a>
        </div>
      </div>
    </div>
  </section>

  <section id="promotions" class="py-20 bg-amber-50 hidden">
    <div class="max-w-7xl mx-auto px-4">
      <div class="text-center mb-16">
        <h2 class="text-4xl md:text-5xl font-bold mb-4 kaushan-script-regular text-amber-600">Nos Offres Spéciales</h2>
        <p class="text-xl text-gray-600 max-w-2xl mx-auto">Profitez de nos meilleures offres, disponibles pour un temps limité!</p>
      </div>

      <div id="promotionsGrid" class="horizontal-scroll-container">
        </div>
    </div>
  </section>

  <section id="popular" class="py-20 bg-white">
    <div class="max-w-7xl mx-auto px-4">
      <div class="text-center mb-16">
        <h2 class="text-4xl md:text-5xl font-bold mb-4 kaushan-script-regular text-gray-800">Nos plats populaires</h2>
        <p class="text-xl text-gray-600 max-w-2xl mx-auto">Découvrez les favoris de nos clients, préparés avec des ingrédients frais</p>
      </div>

      <div id="popularGrid" class="horizontal-scroll-container">
        <div class="col-span-full flex justify-center py-8"><div class="loading-spinner"></div></div>
      </div>
    </div>
  </section>

  <section id="menu-unified" class="menu-section py-12 bg-gray-50">
    <div class="max-w-7xl mx-auto px-4">
      <div class="text-center mb-16">
        <h2 class="text-4xl md:text-5xl font-bold mb-4 kaushan-script-regular text-gray-800">Notre Menu Complet</h2>
        <p class="text-xl text-gray-600 max-w-2xl mx-auto">Découvrez toutes nos spécialités en un seul endroit.</p>
      </div>
  
      <div class="mb-12">
        <div class="max-w-md mx-auto relative">
          <input type="text" id="menuSearch-unified" placeholder="Rechercher un plat..." class="w-full pl-12 pr-4 py-4 rounded-2xl border-2 border-gray-200 focus:border-green-500 focus:outline-none text-lg menu-search-input">
          <svg class="absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
        </div>
      </div>
  
      <div id="filter-container" class="mb-12">
        <div class="relative">
          <div class="filter-scroll" id="filterScrollContainer-unified">
            </div>
        </div>
      </div>
  
      <div id="menuContent-unified" class="menu-content-container">
        <div class="col-span-full flex justify-center py-8"><div class="loading-spinner"></div></div>
      </div>
      <div id="noResultsMessage-unified" class="hidden text-center text-gray-500 py-16">
        <p class="text-xl font-semibold">Oops!</p>
        <p class="mt-2">Nous n'avons trouvé aucun plat correspondant à votre recherche.</p>
      </div>

    </div>
  </section>

  <section id="locations" class="py-20 bg-gray-900 text-white">
    <div class="max-w-7xl mx-auto px-4">
      <div class="text-center mb-16">
        <h2 class="text-4xl md:text-5xl font-bold mb-4 kaushan-script-regular text-yellow-400">Notre adresse</h2>
        <p class="text-xl text-gray-300 max-w-2xl mx-auto">Venez nous rendre visite ou commandez en livraison</p>
      </div>

      <div class="grid md:grid-cols-2 gap-8">
        <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-8">
          <h3 class="text-2xl font-bold mb-4">Restaurant</h3>

          <div class="w-full mb-6">
            <img src="assets/qaouti-storefront.png" 
                 alt="Qaouti House Restaurant" 
                 class="w-full h-64 object-cover rounded-xl"
                 onerror="this.src='https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=600&h=400&fit=crop'">
          </div>

          <a href="https://maps.app.goo.gl/L5BJER3zojCwT1YRA" 
             target="_blank" 
             class="w-full flex items-center justify-center gap-3 bg-blue-500 hover:bg-blue-600 rounded-xl p-4 mb-6 transition-colors duration-300 text-white font-semibold">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
            </svg>
            Localisation
          </a>
          <button onclick="Reclam()" class="w-full flex items-center justify-center gap-4 bg-red-500 hover:bg-red-600 rounded-xl p-4 mb-6 transition-colors duration-300">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
            </svg>
            <div class="text-left">
              <div class="font-semibold">Réclamation</div>
            </div>
          </button>

          <div class="space-y-3">
            <div class="flex items-center gap-3">
              <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
              </svg>
              <span>Avenue Al Massira 10052, Rabat, Maroc</span>
            </div>
            <div class="flex items-center gap-3">
              <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <div>
                <div>Dimanche à Vendredi: 11:00 – 00:45</div>
                <div>Samedi: 11:00 – 00:30</div>
              </div>
            </div>
            <div class="flex items-center gap-3">
              <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
              </svg>
              <span>+212 6 09 93 58 65 </span>
            </div>
          </div>
        </div>

        <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-8">
          <h3 class="text-2xl font-bold mb-6">Commander rapidement</h3>
          <div class="space-y-4">
            <button onclick="contactWhatsApp()" class="w-full flex items-center gap-4 bg-green-500 hover:bg-green-600 rounded-xl p-4 transition-colors duration-300">
              <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.886 3.488"/>
              </svg>
              <div class="text-left">
                <div class="font-semibold">WhatsApp</div>
                <div class="text-sm opacity-90">Message rapide</div>
              </div>
            </button>

            <button onclick="contactCall()" class="w-full flex items-center gap-4 bg-blue-500 hover:bg-blue-600 rounded-xl p-4 transition-colors duration-300">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
              </svg>
              <div class="text-left">
                <div class="font-semibold">Téléphone</div>
                <div class="text-sm opacity-90">Appel direct</div>
              </div>
            </button>

            <button onclick="contactGlovo()" class="w-full flex items-center gap-4 bg-yellow-500 hover:bg-yellow-600 text-gray-900 rounded-xl p-4 transition-colors duration-300">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
              </svg>
              <div class="text-left">
                <div class="font-semibold">Glovo</div>
                <div class="text-sm opacity-90">Livraison Glovo</div>
              </div>
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section id="admin-dashboard" class="py-20 bg-slate-900 text-white">
    <div class="max-w-7xl mx-auto px-4">
      <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-6 mb-12">
        <div>
          <p class="uppercase tracking-[0.3em] text-emerald-400 font-semibold text-sm">Espace équipe</p>
          <h2 class="text-4xl md:text-5xl font-bold kaushan-script-regular text-white mt-3">Tableau de bord Admin</h2>
          <p class="text-gray-300 max-w-2xl mt-5 text-base md:text-lg">
            Surveillez les commandes, partagez les notes de service et gardez votre équipe coordonnée sans quitter le site public.
            Ce tableau de bord léger fonctionne côté client et n'enregistre les données sensibles que sur votre appareil.
          </p>
        </div>
        <div class="bg-white/10 border border-white/10 backdrop-blur-sm px-6 py-5 rounded-2xl text-sm text-gray-200 max-w-sm">
          <p class="font-semibold text-white text-base">Accès rapide</p>
          <p class="mt-2 leading-relaxed">
            Ajoutez ce lien à vos favoris ou scannez le QR code du site depuis la salle pour récupérer vos indicateurs du jour.
          </p>
          <button id="adminLogoutBtn" class="mt-5 inline-flex items-center gap-2 bg-emerald-500 hover:bg-emerald-600 text-white font-semibold px-4 py-2 rounded-xl transition-colors duration-300 hidden">
            Se déconnecter
          </button>
        </div>
      </div>

      <div id="adminLoginCard" class="bg-white text-slate-900 rounded-3xl shadow-2xl p-8 md:p-12">
        <div class="flex flex-col md:flex-row gap-10 items-start">
          <div class="flex-1">
            <h3 class="text-3xl font-bold text-slate-900">Accès sécurisé</h3>
            <p class="text-slate-600 mt-4 text-base md:text-lg">
              Entrez le code interne pour déverrouiller les indicateurs opérationnels et les outils d'organisation de Qaouti House.
            </p>
            <form id="adminLoginForm" class="mt-8 space-y-5">
              <div>
                <label for="adminPasscodeInput" class="block text-sm font-semibold text-slate-700 mb-2">Code d'accès</label>
                <input id="adminPasscodeInput" type="password" autocomplete="current-password" class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200 outline-none transition" placeholder="••••••••" required>
              </div>
              <button type="submit" class="w-full bg-emerald-500 hover:bg-emerald-600 text-white font-semibold py-3.5 rounded-xl transition-colors duration-300">
                Déverrouiller le tableau de bord
              </button>
              <p id="adminLoginError" class="text-sm text-red-500 hidden">Code invalide. Veuillez réessayer.</p>
            </form>
          </div>
          <div class="w-full md:w-80 bg-slate-900 text-white rounded-2xl p-6 border border-white/10">
            <h4 class="text-xl font-semibold">Conseil</h4>
            <p class="text-sm text-gray-300 mt-3 leading-relaxed">
              Utilisez le code communiqué à l'équipe d'encadrement. Vous pouvez modifier ce code directement dans le script si nécessaire.
            </p>
            <div class="mt-6 bg-white/10 rounded-2xl px-5 py-4">
              <p class="uppercase text-xs tracking-widest text-emerald-300">Code par défaut</p>
              <p class="font-mono text-lg mt-2 select-all" id="adminCodeHint">qaouti-admin</p>
            </div>
            <p class="text-xs text-gray-400 mt-4">
              Astuce : activez la sauvegarde locale pour rester connecté sur cet appareil.
            </p>
          </div>
        </div>
      </div>

      <div id="adminDashboardPanel" class="hidden">
        <div class="grid gap-6 md:grid-cols-2 xl:grid-cols-4 mt-12">
          <div class="bg-white/10 border border-white/10 rounded-3xl p-6">
            <p class="uppercase text-xs tracking-widest text-gray-300">Commandes du jour</p>
            <p id="admin-stat-orders" class="mt-4 text-3xl font-bold text-white">0</p>
            <p class="text-sm text-emerald-300 mt-2" id="admin-stat-orders-change"></p>
          </div>
          <div class="bg-white/10 border border-white/10 rounded-3xl p-6">
            <p class="uppercase text-xs tracking-widest text-gray-300">Revenus estimés</p>
            <p id="admin-stat-revenue" class="mt-4 text-3xl font-bold text-white">0 MAD</p>
            <p class="text-sm text-emerald-300 mt-2" id="admin-stat-revenue-change"></p>
          </div>
          <div class="bg-white/10 border border-white/10 rounded-3xl p-6">
            <p class="uppercase text-xs tracking-widest text-gray-300">Temps moyen</p>
            <p id="admin-stat-time" class="mt-4 text-3xl font-bold text-white">0 min</p>
            <p class="text-sm text-emerald-300 mt-2" id="admin-stat-time-change"></p>
          </div>
          <div class="bg-white/10 border border-white/10 rounded-3xl p-6">
            <p class="uppercase text-xs tracking-widest text-gray-300">Satisfaction</p>
            <p id="admin-stat-score" class="mt-4 text-3xl font-bold text-white">0%</p>
            <p class="text-sm text-emerald-300 mt-2" id="admin-stat-score-change"></p>
          </div>
        </div>

        <div class="grid gap-8 lg:grid-cols-3 mt-12">
          <div class="lg:col-span-2 bg-white text-slate-900 rounded-3xl shadow-xl p-8">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
              <div>
                <h3 class="text-2xl font-semibold text-slate-900">Commandes en cours</h3>
                <p class="text-sm text-slate-500">Mettez à jour l'état directement depuis le comptoir.</p>
              </div>
              <span id="adminOrdersUpdated" class="text-xs uppercase tracking-widest text-slate-400"></span>
            </div>
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-slate-200">
                <thead class="bg-slate-50 text-slate-500 text-xs uppercase tracking-widest">
                  <tr>
                    <th scope="col" class="px-4 py-3 text-left">Client</th>
                    <th scope="col" class="px-4 py-3 text-left">Articles</th>
                    <th scope="col" class="px-4 py-3 text-left">Total</th>
                    <th scope="col" class="px-4 py-3 text-left">Statut</th>
                    <th scope="col" class="px-4 py-3 text-left">ETA</th>
                  </tr>
                </thead>
                <tbody id="adminOrdersTableBody" class="divide-y divide-slate-100 text-sm"></tbody>
              </table>
            </div>
          </div>

          <div class="space-y-8">
            <div class="bg-white/10 border border-white/10 rounded-3xl p-6">
              <h3 class="text-xl font-semibold text-white">Notes d'équipe</h3>
              <p class="text-sm text-gray-300 mt-2">Ajoutez des rappels visibles uniquement ici.</p>
              <form id="adminAnnouncementForm" class="mt-5 flex flex-col gap-3">
                <input id="adminAnnouncementInput" type="text" class="w-full px-4 py-3 rounded-xl border border-white/10 bg-white/5 text-white placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-emerald-400" placeholder="Ajouter une note (ex : Prévoir plus de sauces)">
                <button type="submit" class="bg-white text-slate-900 font-semibold py-2.5 rounded-xl hover:bg-slate-100 transition-colors duration-300">Ajouter</button>
              </form>
              <ul id="adminAnnouncementList" class="mt-6 space-y-3 text-sm text-white/90"></ul>
            </div>

            <div class="bg-white/10 border border-white/10 rounded-3xl p-6">
              <h3 class="text-xl font-semibold text-white">Tâches rapides</h3>
              <p class="text-sm text-gray-300 mt-2">Assignez les actions de fin de service.</p>
              <form id="adminTaskForm" class="mt-5 flex flex-col gap-3">
                <input id="adminTaskInput" type="text" class="w-full px-4 py-3 rounded-xl border border-white/10 bg-white/5 text-white placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-emerald-400" placeholder="Ex : Vérifier stocks pain burger">
                <button type="submit" class="bg-emerald-500 hover:bg-emerald-600 text-white font-semibold py-2.5 rounded-xl transition-colors duration-300">Ajouter une tâche</button>
              </form>
              <ul id="adminTaskList" class="mt-6 space-y-3 text-sm"></ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section id="reviews" class="py-20 bg-gradient-to-br from-green-50 to-white">
    <div class="max-w-7xl mx-auto px-4">
      <div class="text-center mb-16 fade-in">
        <h2 class="text-4xl md:text-5xl font-bold text-gray-800 mb-4">
          <span class="kaushan-script-regular text-green-600">Ce que disent nos clients</span>
        </h2>
        <p class="text-xl text-gray-600 max-w-2xl mx-auto">
          Découvrez les avis authentiques de nos clients satisfaits
        </p>
      </div>
      
      <div class="text-center">
        <a href="https://g.page/r/CW_BpVVWMto0EBE/review" target="_blank" rel="noopener" class="bg-amber-500 hover:bg-amber-600 text-black inline-flex items-center gap-3 py-4 px-8 text-lg rounded-lg shadow-md">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.196-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path>
          </svg>
          Laisser un avis
        </a>
      </div>
      <div class="taggbox" style="width:100%;height:100%;overflow:auto;" data-widget-id="298164" data-website="1"></div><script src="https://widget.taggbox.com/embed.min.js" type="text/javascript"></script>
    </div>
  </section>

  <footer class="bg-gray-900 text-white">
    <div class="max-w-7xl mx-auto px-4 py-16">
      <div class="grid md:grid-cols-4 gap-8">
        <div class="md:col-span-2">
          <div class="flex items-center gap-3 mb-6">
            <img src="assets/logo-whiteee.png" alt="Qaouti House" class="h-12 w-12 rounded-full">
            <div>
              <h3 class="text-2xl font-bold kaushan-script-regular text-yellow-400">Qaouti House</h3>
              <p class="text-gray-400">Restaurant & Fast Food</p>
            </div>
          </div>
          <p class="text-gray-300 mb-6 leading-relaxed max-w-md">
            Savourez l'art de la cuisine à Rabat!
          </p>
        </div>
        
        <div>
          <h4 class="font-semibold text-lg mb-6">Liens rapides</h4>
          <ul class="space-y-3">
            <li><a href="#menu-unified" class="text-gray-300 hover:text-white transition-colors duration-300">Menu</a></li>
            <li><a href="#promotions" class="text-gray-300 hover:text-white transition-colors duration-300">Promos</a></li>
            <li><a href="#popular" class="text-gray-300 hover:text-white transition-colors duration-300">Populaire</a></li>
            <li><a href="#locations" class="text-gray-300 hover:text-white transition-colors duration-300">Adresse</a></li>
            <li><a href="#reviews" class="text-gray-300 hover:text-white transition-colors duration-300">Avis clients</a></li>
          </ul>
        </div>
        
        <div>
          <h4 class="font-semibold text-lg mb-6">Contact</h4>
          <ul class="space-y-3">
            <li class="flex items-center gap-3">
              <svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
              </svg>
              <span class="text-gray-300">Avenue Al Massira 10052, Rabat, Maroc</span>
            </li>
            <li class="flex items-center gap-3">
              <svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <div class="text-gray-300 opening-hours">
                <div>Dimanche à Vendredi 11:00–00:45</div>
                <div>Samedi 11:00–00:30</div>
              </div>
            </li>
          </ul>
          <a href="https://www.instagram.com/qaoutihouse/?hl=fr" target="_blank" rel="noopener" class="mt-4 inline-flex items-center gap-2 text-pink-500 hover:text-pink-600 font-bold transition-colors duration-300">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
              <path d="M7.75 2A5.752 5.752 0 002 7.75v8.5A5.752 5.752 0 007.75 22h8.5a5.752 5.752 0 005.75-5.75v-8.5A5.752 5.752 0 0016.25 2h-8.5Zm4.25 6.75a3.25 3.25 0 11-.001 6.5A3.25 3.25 0 0112 8.75Zm5.5-.75a1 1 0 11-2 0 1 1 0 012 0Z"/>
            </svg>
            Instagram
          </a>
        </div>
      </div>
      
      <div class="border-t border-gray-800 mt-12 pt-8 text-center">
        <p class="text-gray-400">© 2025 Qaouti House. Tous droits réservés.</p>
      </div>
    </div>
  </footer>

  <div id="floatingCartBtn" class="fixed bottom-6 right-6 z-40 hidden">
    <button onclick="openCart()" class="bg-green-500 hover:bg-green-600 text-white p-4 rounded-full shadow-xl transition-all duration-300 hover:scale-110">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-1.5 6M7 13l-1.5 6m9.5-6v6a2 2 0 01-2 2H9a2 2 0 01-2-2v-6m8 0V9a2 2 0 00-2-2H9a2 2 0 00-2 2v4.01"></path>
      </svg>
      <span id="floatingCartCount" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center">0</span>
    </button>
  </div>

  <div id="cartModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 hidden">
    <div class="flex items-center justify-center min-h-screen p-4">
      <div class="bg-white rounded-2xl max-w-md w-full max-h-[90vh] overflow-y-auto">
        <div class="p-6 border-b">
          <div class="flex items-center justify-between">
            <h3 class="text-2xl font-bold text-gray-800">Votre Panier</h3>
            <button onclick="closeCart()" class="text-gray-500 hover:text-gray-700">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>
        </div>

        <div class="p-6">
          <div id="cartItems" class="space-y-4 mb-6">
            </div>

          <div id="cartEmpty" class="text-center py-8 hidden">
            <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-1.5 6M7 13l-1.5 6m9.5-6v6a2 2 0 01-2 2H9a2 2 0 01-2-2v-6m8 0V9a2 2 0 00-2-2H9a2 2 0 00-2 2v4.01"></path>
            </svg>
            <p class="text-gray-500">Votre panier est vide</p>
          </div>

          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-3">Mode de service</label>
            <div class="grid grid-cols-3 gap-3 text-center">
              <div>
                <input type="radio" id="dine_in" name="serviceMode" value="dine_in" class="hidden peer">
                <label for="dine_in" class="flex items-center justify-center w-full p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:bg-gray-100 peer-checked:border-green-500 peer-checked:bg-green-500 peer-checked:text-white transition-colors duration-200">
                  <span class="text-sm font-semibold">Sur place</span>
                </label>
              </div>
              <div>
                <input type="radio" id="delivery" name="serviceMode" value="delivery" class="hidden peer" checked>
                <label for="delivery" class="flex items-center justify-center w-full p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:bg-gray-100 peer-checked:border-green-500 peer-checked:bg-green-500 peer-checked:text-white transition-colors duration-200">
                  <span class="text-sm font-semibold">Livraison</span>
                </label>
              </div>
              <div>
                <input type="radio" id="takeaway" name="serviceMode" value="takeaway" class="hidden peer">
                <label for="takeaway" class="flex items-center justify-center w-full p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:bg-gray-100 peer-checked:border-green-500 peer-checked:bg-green-500 peer-checked:text-white transition-colors duration-200">
                  <span class="text-sm font-semibold">À emporter</span>
                </label>
              </div>
            </div>
          </div>

          <div id="cartSummary" class="border-t pt-4">
            <div class="flex justify-between items-center text-xl font-bold mb-6">
              <span>Total:</span>
              <span id="cartTotal" class="text-green-600">0 MAD</span>
            </div>
            <div class="space-y-3">
              <button onclick="proceedToCheckout()" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-xl font-semibold transition-colors duration-300">
                Commander via WhatsApp
              </button>
              <button onclick="clearCart()" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-700 py-3 rounded-xl font-semibold transition-colors duration-300">
                Vider le panier
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="addItemModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 hidden">
    <div class="flex items-center justify-center min-h-screen p-4">
      <div id="modalContentContainer" class="bg-white rounded-2xl max-w-lg w-full max-h-[90vh] flex flex-col">
        <div id="modalContent" class="flex flex-col flex-1 overflow-y-hidden">
          </div>
      </div>
    </div>
  </div>

  <div id="nameModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 hidden">
    <div class="flex items-center justify-center min-h-screen p-4">
      <div class="bg-white rounded-2xl max-w-sm w-full p-6">
        <h3 class="text-xl font-bold text-gray-800 mb-4">Finaliser la commande</h3>
        <p class="text-gray-600 mb-6">Veuillez entrer vos informations pour la commande.</p>
        
        <div class="space-y-4">
          <div>
            <label for="customerNameInput" class="block text-sm font-medium text-gray-700 mb-2">Nom complet</label>
            <input type="text" id="customerNameInput" placeholder="Ex: Hicham Qaouti" class="w-full px-4 py-2 rounded-lg border-2 border-gray-200 focus:border-green-500 focus:outline-none">
          </div>
          <div>
            <label for="customerNotesInput" class="block text-sm font-medium text-gray-700 mb-2">Notes spéciales (allergies, etc.)</label>
            <textarea id="customerNotesInput" placeholder="Ex: Pas de tomates, svp..." rows="3" class="w-full px-4 py-2 rounded-lg border-2 border-gray-200 focus:border-green-500 focus:outline-none"></textarea>
          </div>
        </div>

        <div class="mt-8 flex gap-4">
          <button onclick="closeNameModal()" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-700 py-3 rounded-xl font-semibold transition-colors duration-300">
            Annuler
          </button>
          <button onclick="confirmOrderWithName()" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-xl font-semibold transition-colors duration-300">
            Confirmer
          </button>
        </div>
      </div>
    </div>
  </div>
  <script>
    // Helper to create the same ID everywhere (handles accents)
    const slug = s => s.normalize('NFD')
      .replace(/[\u0300-\u036f]/g,'')
      .toLowerCase()
      .replace(/[^a-z0-9]+/g,'-')
      .replace(/^-+|-+$/g,'');

    const makeItemId = (sectionName, itemName) =>
      `${slug(sectionName)}__${slug(itemName)}`;

    // --- CHANGE #7: Promotions Data ---
    // To add a promotion, add a new object to this array.
    // To hide the section, make this array empty: const promotionsData = [];
    const promotionsData = [/*
      {
        title: "Menu Big King",
        description: "1 Burger Big King, 1 Portion de Frites, et 1 Jus d'Orange.",
        price: 85,
        image: "assets/promo-bigking.jpg", // Make sure you have this image
        // These IDs must match the item IDs generated by makeItemId()
        items: [
          "burger__burger-big-king",
          "supplements__frites",
          "jus__jus-d-orange"
        ]
      },
      // Example of a second promotion (currently commented out)
      
      {
        title: "Menu Noodles",
        description: "1 Noodles Poulet, 1 Portion de Nems, et 1 Boisson.",
        price: 70,
        image: "assets/promo-noodles.jpg", 
        items: [
          "noodles__noodles-poulet",
          // Assuming "Nems" is an item in your menu, otherwise this will fail.
          // "supplements__nems", 
          "dessert__boisson-0-33-cl"
        ]
      }
      */
    ];


      // --- LISTE DES PLATS POPULAIRES (MODIFIEZ CECI) ---
    const popularItemNames = [
      "Burger Big King",
      "Noodles Poulet",
      "Tacos Viande Hachée",
      "Pâtes Saumon",
      "Poké Bowl Saumon",
      "Crêpes Nutella"
    ];
    // ---------------------------------------------------------

    // --- SEPARATE MENU DATA OBJECTS ---
    const menuDataAsiatique = {
      currency: "MAD",
      sections: [
      {
          name: "Sushi",
          items: [
            { name: "Maki Ebi", price: 0, description:"8 pièces" },
            { name: "Maki Surimi", price: 0, description:"8 pièces"  },
            { name: "Maki Saumon", price: 0 , description:"8 pièces" },
            { name: "Futomaki Ebi", price: 0, description:"6 pièces" },
            { name: "Futomaki Surimi", price: 0,description:"6 pièces"},
            { name: "Futomaki Saumon", price: 0,description:"6 pièces"},
            { name: "Futomaki Dragon", price: 0,description:"6 pièces"},
            { name: "Crunchy Qaouti", price: 0,description:"6 pièces"},
            { name: "Crunchy Chef", price: 0,description:"6 pièces"},
            { name: "California Qaouti", price: 0, description:"8 pièces" },
            { name: "California Chef", price: 0, description:"8 pièces" }
          ]
        },
        {
          name: "Poké Bowl",
          items: [
            { name: "Poké Bowl Poulet", price: 55, description: "Riz sushi, mangue, avocat, radis, chou rouge, goma wakami, edamame, sésame" },
            { name: "Poké Bowl Thon", price: 55, description: "Riz sushi, mangue, avocat, radis, chou rouge, goma wakami, edamame, sésame" },
            { name: "Poké Bowl Crevettes", price: 65, description: "Riz sushi, mangue, avocat, radis, chou rouge, goma wakami, edamame, sésame" },
            { name: "Poké Bowl Saumon", price: 70, description: "Riz sushi, mangue, avocat, radis, chou rouge, goma wakami, edamame, sésame" }
          ]
        },
        {
          name: "Noodles",
          items: [
            { name: "Noodles Végétarienne", price: 35},
            { name: "Noodles Poulet", price: 45},
            { name: "Noodles Gambas", price: 55},
            { name: "Noodles Boeuf", price: 60}
          ]
        },
        {
          name: "Les Wok Thailandaises",
          items: [
            { name: "Wok Poulet", price: 50},
            { name: "Wok Poulet Teriyaki", price: 50},
            { name: "Wok Gamba", price: 60},
            { name: "Wok Boeuf", price: 65 }
          ]
        }
      ]
    };

    const menuDataItalienne = {
        currency: "MAD",
        sections: [
            {
                name: "Les Pâtes",
                desc: "Penne ou Tagliatelle",
                items: [
                    { name: "Pâtes Purée Gratin", price: 18, mandatoryChoice: { title: "Type de pâtes", options: [ { name: "Penne", price: 0 }, { name: "Tagliatelle", price: 0 } ]}},
                    { name: "Pâtes Gratin Macaroni", price: 25, mandatoryChoice: { title: "Type de pâtes", options: [ { name: "Penne", price: 0 }, { name: "Tagliatelle", price: 0 } ]}},
                    { 
                        name: "Pâtes Carbonara", 
                        price: 40, mandatoryChoice: { title: "Type de pâtes", options: [ { name: "Penne", price: 0 }, { name: "Tagliatelle", price: 0 } ]}
                    },
                    { 
                        name: "Pâtes Poulet", 
                        price: 40,
                        mandatoryChoice: {
                            title: "Type de pâtes",
                            options: [ { name: "Penne", price: 0 }, { name: "Tagliatelle", price: 0 } ]
                        }
                    },
                    { 
                        name: "Pâtes Bolognaise", 
                        price: 48,
                        mandatoryChoice: {
                            title: "Type de pâtes",
                            options: [ { name: "Penne", price: 0 }, { name: "Tagliatelle", price: 0 } ]
                        }
                    },
                    { name: "Pâtes Lasagnes", price: 48, mandatoryChoice: { title: "Type de pâtes", options: [ { name: "Penne", price: 0 }, { name: "Tagliatelle", price: 0 } ]} },
                    { name: "Pâtes Fruits de mer", price: 50, mandatoryChoice: { title: "Type de pâtes", options: [ { name: "Penne", price: 0 }, { name: "Tagliatelle", price: 0 } ]} },
                    { name: "Pâtes Saumon", price: 55, mandatoryChoice: { title: "Type de pâtes", options: [ { name: "Penne", price: 0 }, { name: "Tagliatelle", price: 0 } ]} }
                ]
            },
            {
                name: "Plats",
                items: [
                    { 
                        name: "Pilon Crispy", 
                        price: 45,
                        description:"Servi avec penne et frites"
                    },
                    { name: "Tenders", price: 45,description:"Servi avec penne ou frites", mandatoryChoice: { title: "Accompagnement", options: [ { name: "Penne", price: 0 }, { name: "Frites", price: 0 } ]} },
                    { 
                        name: "Plat Emincé de Poulet", 
                        price: 50,
                        description:"Servi avec légumes et purée ou frites",
                        mandatoryChoice: {
                            title: "Accompagnement",
                            options: [ { name: "Légumes et Purée", price: 0 }, { name: "Frites", price: 0 } ]
                        }
                    },
                    { name: "Cordon Bleu", price: 55,description:"Servi avec penne ou frites", mandatoryChoice: { title: "Accompagnement", options: [ { name: "Penne", price: 0 }, { name: "Frites", price: 0 } ]} },
                    { 
                        name: "Plat Emincé de Boeuf", 
                        price: 60,
                        description:"Servi avec légumes et purée ou frites",
                        mandatoryChoice: {
                            title: "Accompagnement",
                            options: [ { name: "Légumes et Purée", price: 0 }, { name: "Frites", price: 0 } ]
                        }
                    },
                    { 
                        name: "Crevette à la plancha", 
                        price: 65,
                        description:"Servi avec légumes, penne et frites"
                    },
                    { name: "Escalope (Curry)", price: 66, description:"Servi avec penne ou frites", mandatoryChoice: { title: "Accompagnement", options: [ { name: "Penne", price: 0 }, { name: "Frites", price: 0 } ]} },
                    { 
                        name: "Pavé de Saumon", 
                        price: 75,
                        description:"3 Garnitures"
                    }
                ]
            },
            {
                name: "Les Salades",
                items: [
                    { name: "Salade Marocaine", price: 20 }, 
                    { name: "Salade Niçoise", price: 30 },
                    { name: "Salade César Poulet", price: 35 },
                    { name: "Salade Riche", price: 35 }, 
                    { name: "Salade César Gambas", price: 40 }, 
                    { name: "Salade Chef", price: 45 },
                    { name: "Salade Pêcheur", price: 45 }
                ]
            }
        ]
    };

    const menuDataFastFood = {
        currency: "MAD",
        sections: [
            
            {
                name: "Burger",
                desc: "Sauce, oignon, tomate, laitue, fromage servi avec frites",
                items: [
                    { name: "Burger Chicken Crispy", price: 35},
                    { name: "Cheese Burger", price: 38},
                    { name: "Burger Chicken", price: 38},
                    { name: "Egg Burger", price: 40},
                    { name: "Burger Big King", price: 45},
                    { name: "Burger Onion", price: 45},
                    { name: "Burger Chilly Cheese", price: 48},
                    { name: "Burger Mozzarella Steak", price: 50},
                    { name: "Burger XXXL", price: 55}
                ]
            },
            {
                name: "Tacos",
                desc: "Servi avec frites",
                items: [
                    { name: "Tacos Hot Dog", price: 35 ,mandatoryChoice: { title: "Sauce",options: [ { name: "Biggy", price: 0 }, { name: "Algerienne", price: 0 }, { name: "Barbecue", price: 0 }, { name: "Andalouse", price: 0 }, { name: "Samouraï", price: 0 } ]},supplements: [{ name: "Gratiné", price: 10 },{ name: "Frommage", price: 5 },{ name: "Sauce", price: 3 }]},
                    { name: "Tacos Poulet", price: 40 ,mandatoryChoice: { title: "Sauce",options: [ { name: "Biggy", price: 0 }, { name: "Algerienne", price: 0 }, { name: "Barbecue", price: 0 }, { name: "Andalouse", price: 0 }, { name: "Samouraï", price: 0 } ]},supplements: [{ name: "Gratiné", price: 10 },{ name: "Frommage", price: 5 },{ name: "Sauce", price: 3 }]},
                    { name: "Tacos Nuggets", price: 40,mandatoryChoice: { title: "Sauce",options: [ { name: "Biggy", price: 0 }, { name: "Algerienne", price: 0 }, { name: "Barbecue", price: 0 }, { name: "Andalouse", price: 0 }, { name: "Samouraï", price: 0 } ]},supplements: [{ name: "Gratiné", price: 10 },{ name: "Frommage", price: 5 },{ name: "Sauce", price: 3 }] },
                    { name: "Tacos Viande Hachée", price: 40,mandatoryChoice: { title: "Sauce",options: [ { name: "Biggy", price: 0 }, { name: "Algerienne", price: 0 }, { name: "Barbecue", price: 0 }, { name: "Andalouse", price: 0 }, { name: "Samouraï", price: 0 } ]},supplements: [{ name: "Gratiné", price: 10 },{ name: "Frommage", price: 5 },{ name: "Sauce", price: 3 }] },
                    { name: "Tacos Pepperoni", price: 40,mandatoryChoice: { title: "Sauce",options: [ { name: "Biggy", price: 0 }, { name: "Algerienne", price: 0 }, { name: "Barbecue", price: 0 }, { name: "Andalouse", price: 0 }, { name: "Samouraï", price: 0 } ]},supplements: [{ name: "Gratiné", price: 10 },{ name: "Frommage", price: 5 },{ name: "Sauce", price: 3 }] },
                    { name: "Tacos Mixte", price: 45 ,mandatoryChoice: { title: "Sauce",options: [ { name: "Biggy", price: 0 }, { name: "Algerienne", price: 0 }, { name: "Barbecue", price: 0 }, { name: "Andalouse", price: 0 }, { name: "Samouraï", price: 0 } ]},supplements: [{ name: "Gratiné", price: 10 },{ name: "Frommage", price: 5 },{ name: "Sauce", price: 3 }]},
                    { name: "Tacos Cordon Bleu", price: 45,mandatoryChoice: { title: "Sauce",options: [ { name: "Biggy", price: 0 }, { name: "Algerienne", price: 0 }, { name: "Barbecue", price: 0 }, { name: "Andalouse", price: 0 }, { name: "Samouraï", price: 0 } ]},supplements: [{ name: "Gratiné", price: 10 },{ name: "Frommage", price: 5 },{ name: "Sauce", price: 3 }] },
                    { name: "Tacos Fruits de mer", price: 45,mandatoryChoice: { title: "Sauce",options: [ { name: "Biggy", price: 0 }, { name: "Algerienne", price: 0 }, { name: "Barbecue", price: 0 }, { name: "Andalouse", price: 0 }, { name: "Samouraï", price: 0 } ]},supplements: [{ name: "Gratiné", price: 10 },{ name: "Frommage", price: 5 },{ name: "Sauce", price: 3 }] }
                ]
            },
            {
                name: "Naata",
                items: [
                    { name: "Naata Poulet", price: 38 },
                    { name: "Naata Viande Hachée", price: 42 },
                    { name: "Naata Fruits de mer", price: 45 },
                    { name: "Naata Mixte", price: 48 }
                ]
            },
            {
                name: "Pasticcio ou Poutine",
                items: [
                    { name: "Pasticcio Hot Dog", price: 35 }, 
                    { name: "Pasticcio Dinde Fumé", price: 35 },
                    { name: "Pasticcio Poulet", price: 37 }, 
                    { name: "Pasticcio Viande Hachée", price: 37 },
                    { name: "Pasticcio Nuggets", price: 37 }, 
                    { name: "Pasticcio Mixte", price: 45 },
                    { name: "Pasticcio Fruits de mer", price: 45 }, 
                    { name: "Pasticcio Cordon Bleu", price: 45 }
                ]
            },
            {
                name: "Ciabata",
                desc: "Oignon, tomate, laitue, frommage servi avec frites",
                items: [
                    { name: "Ciabata Thon", price: 25 ,mandatoryChoice: { title: "Sauce",options: [ { name: "Biggy", price: 0 }, { name: "Algerienne", price: 0 }, { name: "Maison", price: 0 }]}}, 
                    { name: "Ciabata Poulet", price: 30 ,mandatoryChoice: { title: "Sauce",options: [ { name: "Biggy", price: 0 }, { name: "Algerienne", price: 0 }, { name: "Maison", price: 0 }]}},
                    { name: "Ciabata Viande Hachée", price: 32 ,mandatoryChoice: { title: "Sauce",options: [ { name: "Biggy", price: 0 }, { name: "Algerienne", price: 0 }, { name: "Maison", price: 0 }]}}, 
                    { name: "Ciabata Mixte", price: 35 ,mandatoryChoice: { title: "Sauce",options: [ { name: "Biggy", price: 0 }, { name: "Algerienne", price: 0 }, { name: "Maison", price: 0 }]}},
                    { name: "Ciabata Fruits de mer", price: 35 ,mandatoryChoice: { title: "Sauce",options: [ { name: "Biggy", price: 0 }, { name: "Algerienne", price: 0 }, { name: "Maison", price: 0 }]}}
                ]
            },
            {
                name: "Boca",
                desc: "Sauce, oignon, tomate, laitue, frommage servi avec frites",
                items: [
                    { name: "Boca Chicken", price: 35 ,mandatoryChoice: { title: "Sauce",options: [ { name: "Biggy", price: 0 }, { name: "Algerienne", price: 0 }, { name: "Maison", price: 0 }]}}, 
                    { name: "Boca Chicken Crispy", price: 38 ,mandatoryChoice: { title: "Sauce",options: [ { name: "Biggy", price: 0 }, { name: "Algerienne", price: 0 }, { name: "Maison", price: 0 }]}},
                    { name: "Boca Viande Hachée", price: 38 ,mandatoryChoice: { title: "Sauce",options: [ { name: "Biggy", price: 0 }, { name: "Algerienne", price: 0 }, { name: "Maison", price: 0 }]}},
                    { name: "Boca Cordon Bleu", price: 40 ,mandatoryChoice: { title: "Sauce",options: [ { name: "Biggy", price: 0 }, { name: "Algerienne", price: 0 }, { name: "Maison", price: 0 }]}}
                ]
            },
            {
                name: "M9ila",
                items: [
                    { name: "M9ila Viande Hachée", price: 35 }, 
                    { name: "M9ila Poulet", price: 35 },
                    { name: "M9ila Crevette pil pil", price: 40 }, 
                    { name: "M9ila Fruits de mer", price: 40 }
                ]
            },
            {
                name: "Couscous",
                desc:"Chaque Vendredi seulement servi avec LBEN",
                items: [
                    { name: "Couscous Poulet", price: 45 },
                    { name: "Couscous Viande", price: 50 }
                ]
            },
            {
                name: "Kumpir",
                items: [
                    { name: "Kumpir Fromage", price: 25 },
                    { name: "Kumpir Thonioli", price: 35 }, 
                    { name: "Kumpir Kebab", price: 40 }, 
                    { name: "Kumpir Salata", price: 40 },
                    { name: "Kumpir Fruits de mer", price: 45 }, 
                    { name: "Kumpir House", price: 45 }
                ]
            },
        ]
    };

    const menuDataDessert = {
        currency: "MAD",
        sections: [
            
            {
                name: "Crêpes Sucrées",
                items: [
                    { name: "Crêpes Caramel", price: 20 }, 
                    { name: "Crêpes Nutella", price: 20 },
                    { name: "Crêpes 3 Chocolats", price: 30 }, 
                    { name: "Crêpes 3 Fruits", price: 30 },
                    { name: "Crêpes Kinder Bueno", price: 35 }, 
                    { name: "Crêpes Browni 3 Chocolats", price: 35 }, 
                    { name: "Crêpes Roulée Spéculos", price: 35 }, 
                    { name: "Crêpes Roulée", price: 35,description:"Banane" },
                    { name: "Crêpes Gourmand", price: 40,description:"Oreo, Fruits, Banane" }
                ]
            },
            {
                name: "Crêpes Salées",
                items: [
                    { name: "Crêpes Carbonara", price: 30 },
                    { name: "Crêpes Emincé de Poulet", price: 35 }, 
                    { name: "Crêpes Fruits de mer", price: 40 }, 
                    { name: "Crêpes Steak Haché", price: 40 }
                ]
            },
            {
                name: "Dessert",
                items: [
                    { name: "Oulmes 0.5 cl", price: 9 },
                    { name: "Eau minérale 0.5 cl", price: 5 },
                    { name: "Boisson 0.33 cl", price: 15,mandatoryChoice: { title: "Choisir un boisson", options: [ { name: "Coca", price: 0 }, { name: "Hawai", price: 0 },{ name: "Coca Zero", price: 0 }, { name: "Sprite", price: 0 }, { name: "Poms", price: 0 }, { name: "Schwepps Citron", price: 0 } ]}},
                    { name: "Les verrines", price: 20, mandatoryChoice: { title: "Flavor",options: [ { name: "Velvedel", price: 0 }, { name: "Framboise", price: 0 }, { name: "Citron", price: 0 }, { name: "Opera", price: 0 }, { name: "Forêt-noire", price: 0 } ]}}
                ]
            },
            {
                name: "Jus",
                items: [
                    { name: "Jus de Citron", price: 12 }, 
                    { name: "Jus d'Orange", price: 15 },
                    { name: "Jus de Choix", price: 20 }, 
                    { name: "Jus Panaché", price: 20 }
                ]
            },
            {
                name: "Jus Spéciaux",
                items: [
                    { name: "Sportifs", price: 25 ,description:"Orange, Fruits Rouges"}, 
                    { name: "Hawai", price: 25,description:"Orange, Ananas, Mangue, Papaye" },
                    { name: "Énergétique", price: 25,description:"Orange, Citron, Gingembre" }, 
                    { name: "Avocat", price: 25,description:"Fruits secs" },
                    { name: "Exotique", price: 25,description:"Orange, Passion, Ananas, Papaye" }, 
                    { name: "Fraîche", price: 25,description:"Orange, Mangue, Amande" },
                    { name: "Tropical", price: 25,description:"Orange, Mangue, Fraise, Avocat" }, 
                    { name: "Royal", price: 25,description:"Avocat, Fraise, Fruits secs" }
                ]
            },
            {
                name: "Supplements",
                items: [
                    { name: "Frites", price: 10 }, 
                    { name: "Oignon", price: 15 ,description: "6 pièces"}, 
                    { name: "Potatoes", price: 15 },
                    { name: "Nuggets", price: 25,description: "6 pièces" },
                    { name: "Chili Cheese", price: 25 ,description: "6 pièces"},
                    { name: "Sticks Mozzarella", price: 35 ,description: "6 pièces"}
                ]
            }
        ]
    };

    // --- COMBINED MENU DATA OBJECT ---
    const menuDataCombined = {
      currency: "MAD",
      sections: [
        ...menuDataAsiatique.sections,
        ...menuDataItalienne.sections,
        ...menuDataFastFood.sections,
        ...menuDataDessert.sections,
      ]
    };

    // --- ADMIN PANEL CONFIGURATION ---
    const ADMIN_PASSCODE = 'qaouti-admin';
    const ADMIN_STORAGE_KEYS = {
      auth: 'qaoutiAdminAuth',
      notes: 'qaoutiAdminNotes',
      tasks: 'qaoutiAdminTasks'
    };

    const parseStoredArray = (value) => {
      if (!value) return [];
      try {
        const parsed = JSON.parse(value);
        return Array.isArray(parsed) ? parsed : [];
      } catch (error) {
        console.warn('Impossible de lire les données Admin :', error);
        return [];
      }
    };

    const initializeAdminPanel = () => {
      const loginCard = document.getElementById('adminLoginCard');
      const dashboardPanel = document.getElementById('adminDashboardPanel');
      const loginForm = document.getElementById('adminLoginForm');
      const passcodeInput = document.getElementById('adminPasscodeInput');
      const loginError = document.getElementById('adminLoginError');
      const logoutBtn = document.getElementById('adminLogoutBtn');
      const quickAccessButton = document.getElementById('adminQuickAccessButton');
      const adminAnchors = document.querySelectorAll('[data-admin-link]');
      const announcementForm = document.getElementById('adminAnnouncementForm');
      const announcementInput = document.getElementById('adminAnnouncementInput');
      const announcementList = document.getElementById('adminAnnouncementList');
      const taskForm = document.getElementById('adminTaskForm');
      const taskInput = document.getElementById('adminTaskInput');
      const taskList = document.getElementById('adminTaskList');
      const ordersTableBody = document.getElementById('adminOrdersTableBody');
      const ordersUpdated = document.getElementById('adminOrdersUpdated');
      const statOrders = document.getElementById('admin-stat-orders');
      const statOrdersChange = document.getElementById('admin-stat-orders-change');
      const statRevenue = document.getElementById('admin-stat-revenue');
      const statRevenueChange = document.getElementById('admin-stat-revenue-change');
      const statTime = document.getElementById('admin-stat-time');
      const statTimeChange = document.getElementById('admin-stat-time-change');
      const statScore = document.getElementById('admin-stat-score');
      const statScoreChange = document.getElementById('admin-stat-score-change');

      if (!loginCard || !dashboardPanel || !loginForm || !passcodeInput) {
        return;
      }

      const currencyFormatter = new Intl.NumberFormat('fr-MA', {
        style: 'currency',
        currency: 'MAD',
        maximumFractionDigits: 0
      });

      const adminMetrics = {
        orders: { value: 42, change: '+8 vs hier' },
        revenue: { value: 2310, change: '+12 % semaine' },
        time: { value: 18, change: 'Objectif < 20 min' },
        score: { value: 97, change: 'Note Google 4,9/5' }
      };

      const sampleOrders = [
        { id: 'CMD-482', customer: 'Sara B.', items: 3, total: 145, status: 'En préparation', eta: '12 min' },
        { id: 'CMD-483', customer: 'Yassine M.', items: 5, total: 220, status: 'Prête', eta: 'À remettre' },
        { id: 'CMD-484', customer: 'Amal R.', items: 2, total: 95, status: 'En livraison', eta: '08 min' },
        { id: 'CMD-485', customer: 'Omar K.', items: 4, total: 180, status: 'En préparation', eta: '15 min' }
      ];

      const statusClasses = {
        'En préparation': 'bg-amber-100 text-amber-700',
        'Prête': 'bg-emerald-100 text-emerald-700',
        'En livraison': 'bg-sky-100 text-sky-700'
      };

      let adminAnnouncements = parseStoredArray(localStorage.getItem(ADMIN_STORAGE_KEYS.notes));
      let adminTasks = parseStoredArray(localStorage.getItem(ADMIN_STORAGE_KEYS.tasks));

      const persistAnnouncements = () => {
        localStorage.setItem(ADMIN_STORAGE_KEYS.notes, JSON.stringify(adminAnnouncements));
      };

      const persistTasks = () => {
        localStorage.setItem(ADMIN_STORAGE_KEYS.tasks, JSON.stringify(adminTasks));
      };

      const renderAnnouncements = () => {
        if (!announcementList) return;
        if (!adminAnnouncements.length) {
          announcementList.innerHTML = '<li class="text-sm text-gray-300 italic">Aucune note enregistrée pour l’instant.</li>';
          return;
        }
        announcementList.innerHTML = adminAnnouncements.map(note => `
          <li class="flex items-start justify-between gap-3 bg-white/5 px-4 py-3 rounded-xl border border-white/10">
            <div>
              <p class="font-medium text-white/90">${note.text}</p>
              <p class="text-xs text-gray-400 mt-1">${note.createdAt}</p>
            </div>
            <button type="button" class="text-xs text-red-300 hover:text-red-200" data-action="delete-note" data-note-id="${note.id}">
              Supprimer
            </button>
          </li>
        `).join('');
      };

      const renderTasks = () => {
        if (!taskList) return;
        if (!adminTasks.length) {
          taskList.innerHTML = '<li class="text-sm text-gray-300 italic">Aucune tâche planifiée.</li>';
          return;
        }
        taskList.innerHTML = adminTasks.map(task => `
          <li class="flex items-center justify-between gap-3 bg-white/5 px-4 py-3 rounded-xl border border-white/10">
            <label class="flex items-start gap-3 w-full cursor-pointer">
              <input type="checkbox" class="mt-1 h-4 w-4 rounded border-white/30 bg-white/10 text-emerald-500 focus:ring-emerald-400" data-task-id="${task.id}" ${task.done ? 'checked' : ''}>
              <div>
                <p class="font-medium ${task.done ? 'line-through text-gray-400' : 'text-white'}">${task.text}</p>
                <p class="text-xs text-gray-400 mt-1">${task.createdAt}</p>
              </div>
            </label>
            <button type="button" class="text-xs text-red-300 hover:text-red-200" data-action="delete-task" data-task-id="${task.id}">
              Supprimer
            </button>
          </li>
        `).join('');
      };

      const populateOrders = () => {
        if (!ordersTableBody) return;
        ordersTableBody.innerHTML = sampleOrders.map(order => {
          const badgeClass = statusClasses[order.status] || 'bg-slate-100 text-slate-600';
          return `
            <tr class="hover:bg-slate-50 transition-colors">
              <td class="px-4 py-4">
                <p class="font-semibold text-slate-900">${order.customer}</p>
                <p class="text-xs text-slate-400 mt-1">${order.id}</p>
              </td>
              <td class="px-4 py-4">${order.items}</td>
              <td class="px-4 py-4 font-semibold">${currencyFormatter.format(order.total)}</td>
              <td class="px-4 py-4">
                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold ${badgeClass}">${order.status}</span>
              </td>
              <td class="px-4 py-4 text-slate-500">${order.eta}</td>
            </tr>
          `;
        }).join('');

        if (ordersUpdated) {
          const now = new Date();
          ordersUpdated.textContent = `Mis à jour ${now.toLocaleDateString('fr-FR', { day: '2-digit', month: '2-digit' })} à ${now.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' })}`;
        }
      };

      const populateMetrics = () => {
        if (statOrders) statOrders.textContent = adminMetrics.orders.value;
        if (statOrdersChange) statOrdersChange.textContent = adminMetrics.orders.change;
        if (statRevenue) statRevenue.textContent = currencyFormatter.format(adminMetrics.revenue.value);
        if (statRevenueChange) statRevenueChange.textContent = adminMetrics.revenue.change;
        if (statTime) statTime.textContent = `${adminMetrics.time.value} min`;
        if (statTimeChange) statTimeChange.textContent = adminMetrics.time.change;
        if (statScore) statScore.textContent = `${adminMetrics.score.value}%`;
        if (statScoreChange) statScoreChange.textContent = adminMetrics.score.change;
      };

      const scrollToAdmin = () => {
        const adminSection = document.getElementById('admin-dashboard');
        if (adminSection) {
          adminSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
          if (window.location.hash !== '#admin-dashboard') {
            const { pathname, search } = window.location;
            history.replaceState(null, '', `${pathname}${search}#admin-dashboard`);
          }
          setTimeout(() => passcodeInput?.focus(), 500);
        }
      };

      adminAnchors.forEach(anchor => {
        anchor.addEventListener('click', (event) => {
          if (event.metaKey || event.ctrlKey || event.shiftKey || event.altKey || event.button === 1) {
            return;
          }
          event.preventDefault();
          scrollToAdmin();
        });
      });

      quickAccessButton?.addEventListener('click', scrollToAdmin);

      const setAuthState = (isAuthenticated) => {
        if (isAuthenticated) {
          loginCard.classList.add('hidden');
          dashboardPanel.classList.remove('hidden');
          if (logoutBtn) logoutBtn.classList.remove('hidden');
          if (quickAccessButton) {
            quickAccessButton.classList.add('opacity-0', 'pointer-events-none');
            quickAccessButton.setAttribute('aria-hidden', 'true');
          }
          populateMetrics();
          populateOrders();
          renderAnnouncements();
          renderTasks();
        } else {
          loginCard.classList.remove('hidden');
          dashboardPanel.classList.add('hidden');
          if (logoutBtn) logoutBtn.classList.add('hidden');
          if (quickAccessButton) {
            quickAccessButton.classList.remove('opacity-0', 'pointer-events-none');
            quickAccessButton.setAttribute('aria-hidden', 'false');
          }
          passcodeInput.value = '';
        }
        loginError?.classList.add('hidden');
        localStorage.setItem(ADMIN_STORAGE_KEYS.auth, isAuthenticated ? 'true' : 'false');
      };

      loginForm.addEventListener('submit', (event) => {
        event.preventDefault();
        const code = passcodeInput.value.trim();
        if (code === ADMIN_PASSCODE) {
          setAuthState(true);
        } else {
          loginError?.classList.remove('hidden');
        }
      });

      logoutBtn?.addEventListener('click', () => {
        setAuthState(false);
        passcodeInput.focus();
      });

      announcementForm?.addEventListener('submit', (event) => {
        event.preventDefault();
        const text = (announcementInput?.value || '').trim();
        if (!text) return;
        const now = new Date();
        adminAnnouncements = [
          {
            id: Date.now(),
            text,
            createdAt: now.toLocaleString('fr-FR', { day: '2-digit', month: '2-digit', hour: '2-digit', minute: '2-digit' })
          },
          ...adminAnnouncements
        ];
        persistAnnouncements();
        renderAnnouncements();
        announcementForm.reset();
        announcementInput?.focus();
      });

      announcementList?.addEventListener('click', (event) => {
        const target = event.target;
        if (target instanceof HTMLElement && target.dataset.action === 'delete-note') {
          const noteId = Number(target.dataset.noteId);
          adminAnnouncements = adminAnnouncements.filter(note => note.id !== noteId);
          persistAnnouncements();
          renderAnnouncements();
        }
      });

      taskForm?.addEventListener('submit', (event) => {
        event.preventDefault();
        const text = (taskInput?.value || '').trim();
        if (!text) return;
        const now = new Date();
        adminTasks = [
          ...adminTasks,
          {
            id: Date.now(),
            text,
            done: false,
            createdAt: now.toLocaleString('fr-FR', { day: '2-digit', month: '2-digit', hour: '2-digit', minute: '2-digit' })
          }
        ];
        persistTasks();
        renderTasks();
        taskForm.reset();
        taskInput?.focus();
      });

      taskList?.addEventListener('change', (event) => {
        const target = event.target;
        if (target instanceof HTMLInputElement && target.dataset.taskId) {
          const taskId = Number(target.dataset.taskId);
          adminTasks = adminTasks.map(task => (
            task.id === taskId ? { ...task, done: target.checked } : task
          ));
          persistTasks();
          renderTasks();
        }
      });

      taskList?.addEventListener('click', (event) => {
        const target = event.target;
        if (target instanceof HTMLElement && target.dataset.action === 'delete-task') {
          const taskId = Number(target.dataset.taskId);
          adminTasks = adminTasks.filter(task => task.id !== taskId);
          persistTasks();
          renderTasks();
        }
      });

      const storedAuth = localStorage.getItem(ADMIN_STORAGE_KEYS.auth) === 'true';
      setAuthState(storedAuth);
      if (window.location.hash === '#admin-dashboard' || storedAuth) {
        setTimeout(scrollToAdmin, 100);
      }
    };

    const findItemById = (itemId) => {
      for (const section of menuDataCombined.sections) {
        // Re-create the ID for each item to find a match
        const itemFromDb = section.items.find(i => makeItemId(section.name, i.name) === itemId);
        if (itemFromDb) {
          // If found, return the full item data along with its category and ID
          return {
            ...itemFromDb,
            id: itemId,
            image: getItemImage(itemFromDb.name, section.name),
            category: section.name,
            sectionDesc: section.desc || ''
          };
        }
      }
      // Return null if no item with that ID is found
      console.error("Item not found with ID:", itemId);
      return null;
    };


    // Images for menu items
    const menuImages = {
                                                      // --- ASIATIQUE ---
      "Sushi":"assets/crunchy.jpg",
      "California Chef": "assets/California-red-roll.png",
      "California Qaouti": "assets/California-red-roll.png",
      "Crunchy Chef": "assets/Crunchyy.jpg",
      "Crunchy Qaouti": "assets/Crunchyy.jpg",
      "Futomaki Ebi": "assets/futomaki.jpg",
      "Futomaki Surimi": "assets/futomaki.jpg",
      "Futomaki Dragon": "assets/futomaki.jpg",
      "Futomaki Saumon": "assets/futomaki.jpg",
      "Maki Ebi": "assets/Maki-saumon-avocat.jpg",
      "Maki Surimi": "assets/Maki-saumon-avocat.jpg",
      "Maki Saumon": "assets/Maki-saumon-avocat.jpg",

      "Poké Bowl":'assets/pkthon.jpg',
      "Poké Bowl Poulet":'assets/pkpoulet.jpg',
      "Poké Bowl Crevettes":'assets/pkcr.jpg',
      "Poké Bowl Thon":'assets/pkthon.jpg',
      "Poké Bowl Saumon":'assets/pksaumon.jpg',

      "Noodles": "assets/noodles poulet.jpg",
      "Noodles Poulet": "assets/noodles poulet.jpg",
      // "Noodles Gambas": "assets/noodles gambas.jpeg",
      "Noodles Boeuf": "assets/pates thai boeuf.jpg",
      // "Noodles Végétarienne": "assets/noodles végétarienne.jpeg",


      "Les Wok Thailandaises": "assets/wok gambas.jpg",
      // "Wok Poulet": "assets/wok poulet.jpeg",
      "Wok Boeuf": "assets/wok boeuf.jpg",
      "Wok Gamba": "assets/wok gambas.jpg",
      // "Wok Poulet Teriyaki": "assets/wok poulet teriyaki.jpeg",

                                                          // --- ITALIENNE ---
      "Les Pâtes": "assets/tag fruitsdemer.jpg",
      // "Pâtes Purée Gratin": "assets/pâtes purée gratin.jpeg",
      // "Pâtes Gratin Macaroni": "assets/pâtes gratin macaroni.jpeg",
      "Pâtes Carbonara": "assets/tag carbonada.jpg",
      "Pâtes Poulet": "assets/tag poulet.jpg",
      "Pâtes Bolognaise": "assets/pates bolognaises.jpg",
      "Pâtes Fruits de mer": "assets/tag fruitsdemer.jpg",
      // "Pâtes Lasagnes": "assets/pâtes lasagnes.jpeg",
      "Pâtes Saumon": "assets/TAG SUMO.jpg",


      "Plats": "assets/emince poulet.jpg",
      "Plat Emincé de Poulet": "assets/emince poulet.jpg",
      // "Plat Emincé de Boeuf": "assets/plat emincé de boeuf.jpeg",
      // "Crevette à la plancha": "assets/crevette à la plancha.jpeg",
      // "Pavé de Saumon": "assets/pavé de saumon.jpeg",
      // "Pilon Crispy": "assets/pilon crispy.jpeg",
      "Escalope (Curry)": "assets/curry.png",
      "Cordon Bleu": "assets/cordon bleu.jpeg",
      // "Tenders": "assets/tenders.jpeg",

                                                      // --- FAST FOOD ---
      "Burger": "assets/burger big king.jpeg",
      "Burger Chicken Crispy": "assets/burger chicken crispy.jpg",
      // "Cheese Burger": "assets/cheese burger.jpeg",
      //"Burger Chicken": "assets/burger chicken.jpeg",
      "Burger Big King": "assets/burger big king.jpeg",
      // "Egg Burger": "assets/egg burger.jpeg",
      // "Burger XXXL": "assets/burger xxxl.jpeg",
      // "Burger Mozzarella Steak": "assets/burger mozzarella steak.jpeg",
      // "Burger Onion": "assets/burger onion.jpeg",
      //"Burger Chilly Cheese": "assets/burger chilly cheese.jpeg",


      "Tacos": "assets/tacos vh.jpeg",
      // "Tacos Poulet": "assets/tacos poulet.jpeg",
      // "Tacos Nuggets": "assets/tacos nuggets.jpeg",
      // "Tacos Mixte": "assets/tacos mixte.jpeg",
      "Tacos Viande Hachée": "assets/tacos vh.jpeg",
      // "Tacos Cordon Bleu": "assets/tacos cordon bleu.jpeg",
      // "Tacos Hot Dog": "assets/tacos hot dog.jpeg",
      // "Tacos Fruits de mer": "assets/tacos fruits de mer.jpeg",
      // "Tacos Pepperoni": "assets/tacos pepperoni.jpeg",


      "Naata":"assets/nataa pl.jpeg",
      "Naata Poulet":"assets/nataa pl.jpeg",
      "Naata Viande Hachée":"assets/nataa vh.jpeg",
      "Naata Mixte":"assets/nataa mixte.jpeg",
      // "Naata Fruits de mer": "assets/naata fruits de mer.jpeg",


      "Pasticcio ou Poutine": "assets/poutine.png",
      // "Pasticcio Hot Dog": "assets/pasticcio hot dog.jpeg",
      // "Pasticcio Dinde Fumé": "assets/pasticcio dinde fumé.jpeg",
      // "Pasticcio Poulet": "assets/pasticcio poulet.jpeg",
      // "Pasticcio Viande Hachée": "assets/pasticcio viande hachée.jpeg",
      // "Pasticcio Nuggets": "assets/pasticcio nuggets.jpeg",
      // "Pasticcio Mixte": "assets/pasticcio mixte.jpeg",
      // "Pasticcio Fruits de mer": "assets/pasticcio fruits de mer.jpeg",
      // "Pasticcio Cordon Bleu": "assets/pasticcio cordon bleu.jpeg",


      "Ciabata": "assets/ciabata poulet.jpg",
      // "Ciabata Thon": "assets/ciabata thon.jpeg",
      "Ciabata Poulet": "assets/ciabata poulet.jpg",
      // "Ciabata Viande Hachée": "assets/ciabata viande hachée.jpeg",
      // "Ciabata Mixte": "assets/ciabata mixte.jpeg",
      // "Ciabata Fruits de mer": "assets/ciabata fruits de mer.jpeg",


      "Boca": "assets/boca chicken crispy.jpg",
      // "Boca Chicken": "assets/boca chicken.jpeg",
      "Boca Chicken Crispy": "assets/boca chicken crispy.jpg",
      "Boca Cordon Bleu": "assets/boca cordon bleu.jpg",
      "Boca Viande Hachée": "assets/boca vh.jpeg",


      "M9ila": "assets/m9ila cr.jpeg",
      "M9ila Viande Hachée": "assets/m9ila vh.jpg",
      // "M9ila Poulet": "assets/m9ila poulet.jpeg",
      "M9ila Crevette pil pil": "assets/m9ila cr.jpeg",
      //"M9ila Fruits de mer": "assets/tjfm.png",


      "Couscous":"assets/couscous.png",
      // "Couscous Viande": "assets/couscous viande.jpeg",
      // "Couscous Poulet": "assets/couscous poulet.jpeg",


      "Kumpir": "assets/kumpir salata.jpg",
      "Kumpir Fruits de mer": "assets/kumpir fruitemer.jpg",
      "Kumpir Kebab": "assets/kumpir kebab.jpg",
      "Kumpir Thonioli": "assets/kumpir thon.jpg",
      "Kumpir Salata": "assets/kumpir salata.jpg",
      "Kumpir House": "assets/kumpir f.jpg",
      "Kumpir Fromage": "assets/kumpir cheese.jpg",
      
                                                      // --- DESSERTS & BOISSONS ---
      "Les Salades":"assets/salade necoise.jpg",
      "Salade Marocaine": "assets/salade marocaine.jpg",
      "Salade Niçoise":"assets/salade necoise.jpg",
      // "Salade Riche": "assets/salade riche.jpeg",
      // "Salade César Poulet": "assets/salade césar poulet.jpeg",
      // "Salade César Gambas": "assets/salade césar gambas.jpeg",
      "Salade Chef": "assets/salade chef.jpg",
      "Salade Pêcheur": "assets/salade pecheur.jpg",


      "Crêpes Sucrées": "assets/crepe nutella.jpg",
      // "Crêpes Caramel": "assets/crêpes caramel.jpeg",
      "Crêpes Nutella": "assets/crepe nutella.jpg",
      // "Crêpes Kinder Bueno": "assets/crêpes kinder bueno.jpeg",
      // "Crêpes 3 Chocolats": "assets/crêpes 3 chocolats.jpeg",
      // "Crêpes Browni 3 Chocolats": "assets/crêpes browni 3 chocolats.jpeg",
      // "Crêpes 3 Fruits": "assets/crêpes 3 fruits.jpeg",
      // "Crêpes Roulée Spéculos": "assets/crêpes roulée spéculos.jpeg",
      // "Crêpes Roulée": "assets/crêpes roulée.jpeg",
      // "Crêpes Gourmand": "assets/crêpes gourmand.jpeg",


      "Crêpes Salées":"assets/crepe poulet.jpg",
      "Crêpes Emincé de Poulet": "assets/crepe poulet.jpg",
      // "Crêpes Carbonara": "assets/crêpes carbonara.jpeg",
      // "Crêpes Fruits de mer": "assets/crêpes fruits de mer.jpeg",
      // "Crêpes Steak Haché": "assets/crêpes steak haché.jpeg",


      "Dessert": "assets/tiramisu.png",
      // "Les verrines": "assets/les verrines.jpeg",
      "Boisson 0.33 cl": "assets/soda50.png",
      "Eau minérale 0.5 cl": "assets/eau.png",
      "Oulmes 0.5 cl": "assets/oulmes.png",


      "Jus": "https://images.unsplash.com/photo-1613478223719-2ab802602423?w=400&h=280&fit=crop",
      // "Jus de Choix": "assets/jus de choix.jpeg",
      "Jus d'Orange": "assets/jus d'orange.jpeg",
      "Jus de Citron": "assets/jcitron.png",
      // "Jus Panaché": "assets/jus panaché.jpeg",


      "Jus Spéciaux":"assets/juss.png",
      // "Sportifs": "assets/sportifs.jpeg",
      // "Hawai": "assets/hawai.jpeg",
      // "Énergétique": "assets/énergétique.jpeg",
      // "Avocat": "assets/avocat.jpeg",
      // "Exotique": "assets/exotique.jpeg",
      // "Fraîche": "assets/fraîche.jpeg",
      // "Tropical": "assets/tropical.jpeg",
      // "Royal": "assets/royal.jpeg",


      "Supplements":"assets/fries.png",
      "Frites": "assets/fries.png",
      "Nuggets":"assets/nuggets.png",
      "Oignon":"assets/onion.png",
      "Potatoes":"assets/potatos.png",
      "Sticks Mozzarella":"assets/mozza.png",
      "Chili Cheese": "assets/chili cheese.jpg"
    };

    // Get image for menu item
    const getItemImage = (itemName, sectionName) => {
      if (menuImages[itemName]) {
        return menuImages[itemName];
      }

      for (const [category, image] of Object.entries(menuImages)) {
        if (sectionName.includes(category)) {
          return image;
        }
      }

      return "https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400&h=280&fit=crop";
    };

    // Global variables
    let cart = JSON.parse(localStorage.getItem('qaoutiCart') || '[]');
    let currentModalItem = null;

    // Show toast notification
    const showToast = (message, type = 'success') => {
      try {
        const existingToast = document.querySelector('.toast');
        if (existingToast) {
          existingToast.remove();
        }

        const toast = document.createElement('div');
        toast.className = `toast ${type}`;

        const icon = type === 'success' ? 
          '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>' :
          type === 'error' ?
          '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>' :
          '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';

        toast.innerHTML = `${icon}<span class="toast-message">${message}</span>`;
        document.body.appendChild(toast);
        setTimeout(() => toast.classList.add('show'), 100);
        setTimeout(() => {
          toast.classList.remove('show');
          setTimeout(() => { if (toast.parentNode) toast.remove() }, 300);
        }, 3000);
      } catch (error) {
        console.error('Error showing toast:', error);
      }
    };

    // Update cart count in UI
    const updateCartCount = () => {
      try {
        const count = cart.reduce((sum, item) => sum + item.quantity, 0);
        document.getElementById('cartCount').textContent = count;
        document.getElementById('floatingCartCount').textContent = count;
        const floatingBtn = document.getElementById('floatingCartBtn');
        floatingBtn.classList.toggle('hidden', count === 0);
        updateCartModal();
      } catch (error) {
        console.error('Error updating cart count:', error);
      }
    };

    // Generate unique ID for cart items based on selections
    const generateCartItemId = (item, choices = {}, supplements = [], upsells = []) => {
      const choiceString = Object.entries(choices).sort().map(([k,v]) => `${k}:${v}`).join('|');
      const supplementString = supplements.sort().join('|');
      const upsellString = upsells.sort().join('|');
      return `${item.id}_${choiceString}_${supplementString}_${upsellString}`;
    };

    // Add item to cart
    const addToCart = (item, quantity = 1, choices = {}, supplements = [], upsells = []) => {
      try {
        if (!item || !item.id) {
          showToast('Erreur: Article invalide', 'error');
          return;
        }

        let totalPrice = item.price;
        if (choices.mandatoryChoice && item.mandatoryChoice) {
            const choiceOpt = item.mandatoryChoice.options.find(o => o.name === choices.mandatoryChoice);
            if (choiceOpt) totalPrice += choiceOpt.price;
        }
        if(item.supplements) {
            supplements.forEach(suppName => {
                const supplement = item.supplements.find(s => s.name === suppName);
                if (supplement) totalPrice += supplement.price;
            });
        }
        if(item.upsells) {
            upsells.forEach(upsellName => {
                const upsell = item.upsells.find(u => u.name === upsellName);
                if (upsell) totalPrice += upsell.price;
            });
        }
        
        const cartItemId = generateCartItemId(item, choices, supplements, upsells);
        const existingItem = cart.find(cartItem => cartItem.cartId === cartItemId);

        if (existingItem) {
          existingItem.quantity += quantity;
        } else {
          cart.push({
            cartId: cartItemId, id: item.id, name: item.name,
            price: item.price, totalPrice: totalPrice, quantity: quantity,
            image: item.image, category: item.category,
            choices: choices, supplements: supplements, upsells: upsells,
          });
        }

        localStorage.setItem('qaoutiCart', JSON.stringify(cart));
        updateCartCount();
        showToast('Ajouté au panier', 'success');
      } catch (error) {
        console.error('Error adding to cart:', error);
        showToast('Erreur lors de l\'ajout', 'error');
      }
    };

    // --- CHANGE #3: Function to update modal price in real-time ---
    const updateModalPrice = () => {
        if (!currentModalItem) return;
        
        const modalContentEl = document.getElementById('modalContent');
        const priceEl = document.getElementById('modalTotalPrice');
        if (!modalContentEl || !priceEl) return;

        let total = currentModalItem.price;

        // Mandatory choice
        const mandatoryChoiceInput = modalContentEl.querySelector('input[name="mandatoryChoice"]:checked');
        if (mandatoryChoiceInput && currentModalItem.mandatoryChoice) {
            const option = currentModalItem.mandatoryChoice.options.find(o => o.name === mandatoryChoiceInput.value);
            if(option) total += option.price;
        }

        // Supplements
        const supplementInputs = modalContentEl.querySelectorAll('input[name="supplements"]:checked');
        if (supplementInputs.length > 0 && currentModalItem.supplements) {
            supplementInputs.forEach(input => {
                const supplement = currentModalItem.supplements.find(s => s.name === input.value);
                if(supplement) total += supplement.price;
            });
        }

        // Upsells
        const upsellInputs = modalContentEl.querySelectorAll('input[name="upsells"]:checked');
        if (upsellInputs.length > 0 && currentModalItem.upsells) {
            upsellInputs.forEach(input => {
                const upsell = currentModalItem.upsells.find(u => u.name === input.value);
                if(upsell) total += upsell.price;
            });
        }
        
        const quantity = parseInt(document.getElementById('mainQuantity')?.textContent || '1');
        const finalPrice = total * quantity;

        priceEl.textContent = `Ajouter (${finalPrice} MAD)`;
    };


    // Open add item modal
    const openAddItemModal = (itemId) => {
      const item = findItemById(itemId);
      if (!item) {
        showToast("Erreur: Article non trouvé.", "error");
        return;
      }
      try {
        currentModalItem = item;
        const modal = document.getElementById('addItemModal');
        const modalContent = document.getElementById('modalContent');

        let modalHTML = '';

        // --- 1. Static Header (Does not scroll) ---
        modalHTML += `
          <div class="modal-header-static px-6 pt-6 flex-shrink-0">
            <div class="flex items-center justify-between mb-6">
              <h3 id="modalItemName" class="text-2xl font-bold text-gray-800">${item.name}</h3>
              <button onclick="closeAddItemModal()" class="text-gray-500 hover:text-gray-700">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
              </button>
            </div>
            <img src="${item.image}" alt="${item.name}" class="w-full h-48 object-cover rounded-xl mb-4">
            <div class="text-center">
              <div class="text-2xl font-bold text-green-600 mb-2">${item.price} MAD</div>
              <p class="text-gray-600">${item.description || ''}</p>
            </div>
            <div class="my-6 flex items-center justify-between">
              <span class="font-semibold text-lg">Quantité</span>
              <div class="quantity-selector !my-0">
                <button type="button" class="quantity-btn" onclick="updateModalQuantity(-1)">-</button>
                <span id="mainQuantity" class="quantity-display">1</span>
                <button type="button" class="quantity-btn" onclick="updateModalQuantity(1)">+</button>
              </div>
            </div>
          </div>
        `;
        
        // --- 2. Scrollable Options Area ---
        modalHTML += `<div class="modal-options-scroll flex-1 overflow-y-auto px-6">`;

        if (item.mandatoryChoice) {
          modalHTML += `<div class="choice-group">${item.mandatoryChoice.title}</div>` +
            item.mandatoryChoice.options.map((option, index) => `<div class="choice-option"><input type="radio" id="choice_${index}" name="mandatoryChoice" value="${option.name}" ${index === 0 ? 'checked' : ''}><label for="choice_${index}"><span>${option.name}</span>${option.price > 0 ? `<span class="choice-price">+${option.price} MAD</span>` : ''}</label></div>`).join('');
        }
        
        if (item.upsells && item.upsells.length > 0) {
          modalHTML += `<div class="choice-group bg-green-50"><div class="choice-title">Suggestions du Chef ✨</div>` +
            item.upsells.map((upsell, index) => `<div class="choice-option"><input type="checkbox" id="upsell_${index}" name="upsells" value="${upsell.name}"><label for="upsell_${index}"><span>${upsell.name}</span><span class="choice-price">+${upsell.price} MAD</span></label></div>`).join('') + `</div>`;
        }

        if (item.supplements && item.supplements.length > 0) {
          modalHTML += `<div class="choice-group"><div class="choice-title">Suppléments (optionnel)</div>` +
            item.supplements.map((supplement, index) => `<div class="choice-option"><input type="checkbox" id="supplement_${index}" name="supplements" value="${supplement.name}"><label for="supplement_${index}"><span>${supplement.name}</span><span class="choice-price">+${supplement.price} MAD</span></label></div>`).join('') + `</div>`;
        }

        const crossSellSections = [
            { title: "Ajouter un dessert ?", category: "Dessert" },
            { title: "Ajouter des accompagnements ?", category: "Supplements" },
            { title: "Ajouter un jus ?", category: "Jus" }
        ];

        if (!['Dessert', 'Supplements', 'Jus'].includes(item.category)) {
            modalHTML += `<div class="upsell-section border-t pt-4 mt-4"><h3 class="upsell-title">Complétez votre commande</h3>`;
            crossSellSections.forEach(sectionInfo => {
                const sectionData = menuDataDessert.sections.find(s => s.name === sectionInfo.category);
                if (sectionData && sectionData.items) {
                    modalHTML += `<div class="mb-4"><div class="font-semibold text-gray-800 mb-2">${sectionInfo.title}</div>` +
                        sectionData.items.map((csItem, index) => `<div class="upsell-item"><div class="upsell-item-info"><div class="upsell-item-name">${csItem.name}</div><div class="upsell-item-price">${csItem.price} MAD</div></div><div class="quantity-selector !my-0"><button type="button" class="quantity-btn !w-8 !h-8 !text-sm" onclick="updateCrossSellQuantity('${sectionInfo.category}', ${index}, -1)">-</button><span id="crosssell_${sectionInfo.category}_${index}_qty" class="quantity-display !text-base">0</span><button type="button" class="quantity-btn !w-8 !h-8 !text-sm" onclick="updateCrossSellQuantity('${sectionInfo.category}', ${index}, 1)">+</button></div></div>`).join('') + `</div>`;
                }
            });
            modalHTML += `</div>`;
        }
        
        modalHTML += `</div>`; // Closes modal-options-scroll

        // --- 3. Sticky Footer (Does not scroll) ---
        modalHTML += `
          <div class="modal-footer-sticky p-6 flex-shrink-0 border-t">
            <button onclick="addItemFromModal()" class="w-full bg-green-500 hover:bg-green-600 text-white py-4 rounded-xl font-bold text-lg transition-colors duration-300">
              <span id="modalTotalPrice">Ajouter</span>
            </button>
          </div>
        `;
        
        modalContent.innerHTML = modalHTML;
        modal.classList.remove('hidden');

        // CHANGE #3: Add event listener and initial price calculation
        modalContent.addEventListener('change', updateModalPrice);
        updateModalPrice();

      } catch (error) {
        console.error('Error opening modal:', error);
      }
    };
    
    const updateModalQuantity = (change) => {
        const qtyEl = document.getElementById('mainQuantity');
        if(qtyEl) {
            qtyEl.textContent = Math.max(1, (parseInt(qtyEl.textContent) || 1) + change);
            updateModalPrice(); // CHANGE #3: Update price when quantity changes
        }
    };

    const addItemFromModal = () => {
      try {
        if (!currentModalItem) return;

        // --- Handle the main item ---
        const quantity = parseInt(document.getElementById('mainQuantity').textContent) || 1;
        const choices = {};
        const mandatoryChoiceInput = document.querySelector('input[name="mandatoryChoice"]:checked');
        if (mandatoryChoiceInput) {
          choices.mandatoryChoice = mandatoryChoiceInput.value;
        }
        const supplements = Array.from(document.querySelectorAll('input[name="supplements"]:checked')).map(el => el.value);
        const upsells = Array.from(document.querySelectorAll('input[name="upsells"]:checked')).map(el => el.value);
        addToCart(currentModalItem, quantity, choices, supplements, upsells);

        // --- NEW CODE: Handle the cross-sell items ---
        const crossSellSections = ["Dessert", "Supplements", "Jus"];
        crossSellSections.forEach(category => {
            const sectionData = menuDataDessert.sections.find(s => s.name === category);
            if(sectionData) {
                sectionData.items.forEach((csItem, index) => {
                    const qtyEl = document.getElementById(`crosssell_${category}_${index}_qty`);
                    const qty = qtyEl ? parseInt(qtyEl.textContent) || 0 : 0;
                    if (qty > 0) {
                        const fullItemData = findItemById(makeItemId(category, csItem.name));
                        if(fullItemData) addToCartSimple(fullItemData.id, qty);
                    }
                });
            }
        });
        
        closeAddItemModal();
      } catch (error) {
        console.error('Error adding item from modal:', error);
      }
    };

    // --- You also need these two small helper functions ---
    const updateCrossSellQuantity = (category, index, change) => {
        const qtyEl = document.getElementById(`crosssell_${category}_${index}_qty`);
        if (qtyEl) {
            let currentQty = parseInt(qtyEl.textContent) || 0;
            currentQty = Math.max(0, currentQty + change);
            qtyEl.textContent = currentQty;
        }
    };
    
    // MODIFIED VERSION of addToCartSimple to accept quantity
    const addToCartSimple = (itemId, quantity = 1) => {
      const item = findItemById(itemId);
      if (item) {
        addToCart(item, quantity, {}, [], []);
      }
    };

    const closeAddItemModal = () => {
      document.getElementById('addItemModal').classList.add('hidden');
      currentModalItem = null;
    };

    const removeFromCart = (cartId) => {
      cart = cart.filter(item => item.cartId !== cartId);
      localStorage.setItem('qaoutiCart', JSON.stringify(cart));
      updateCartCount();
      showToast('Article retiré', 'info');
    };

    const updateCartItemQuantity = (cartId, quantity) => {
      const item = cart.find(cartItem => cartItem.cartId === cartId);
      if (item) {
        if (quantity <= 0) {
          removeFromCart(cartId);
        } else {
          item.quantity = quantity;
          localStorage.setItem('qaoutiCart', JSON.stringify(cart));
          updateCartCount();
        }
      }
    };

    const clearCart = () => {
      cart = [];
      localStorage.setItem('qaoutiCart', JSON.stringify(cart));
      updateCartCount();
      showToast('Panier vidé', 'info');
    };

    const updateCartModal = () => {
        const cartItemsEl = document.getElementById('cartItems');
        const cartEmptyEl = document.getElementById('cartEmpty');
        const cartSummaryEl = document.getElementById('cartSummary');
        const cartTotalEl = document.getElementById('cartTotal');

        if (cart.length === 0) {
            cartItemsEl.innerHTML = '';
            cartEmptyEl.classList.remove('hidden');
            cartSummaryEl.classList.add('hidden');
            return;
        }

        cartEmptyEl.classList.add('hidden');
        cartSummaryEl.classList.remove('hidden');
        
        const total = cart.reduce((sum, item) => sum + (item.totalPrice * item.quantity), 0);
        cartTotalEl.textContent = `${total} MAD`;

        cartItemsEl.innerHTML = cart.map(item => {
            const optionsToDisplay = [];
            if (item.choices && item.choices.mandatoryChoice) {
                optionsToDisplay.push(`Choix: ${item.choices.mandatoryChoice}`);
            }
            const allAddons = [...(item.supplements || []), ...(item.upsells || [])];
            if (allAddons.length > 0) {
                optionsToDisplay.push(`+ ${allAddons.join(', ')}`);
            }
            const optionsDisplay = optionsToDisplay.length > 0 ? `<div class="text-xs text-gray-600 mt-1">${optionsToDisplay.join(' | ')}</div>` : '';

            return `
            <div class="flex gap-4 p-4 bg-gray-50 rounded-xl sm:items-center">
              <img src="${item.image}" alt="${item.name}" class="w-16 h-16 object-cover rounded-lg">
              <div class="flex-1">
                <h4 class="font-semibold text-gray-800">${item.name}</h4>
                ${optionsDisplay}
                <div class="mt-2 flex items-center justify-between">
                  <div class="flex items-center gap-2">
                     <button onclick="updateCartItemQuantity('${item.cartId}', ${item.quantity - 1})" class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center hover:bg-gray-300 transition-colors">-</button>
                     <span class="w-6 text-center font-medium">${item.quantity}</span>
                     <button onclick="updateCartItemQuantity('${item.cartId}', ${item.quantity + 1})" class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center hover:bg-gray-300 transition-colors">+</button>
                  </div>
                  <div class="text-green-600 font-bold">${item.totalPrice * item.quantity} MAD</div>
                  <button onclick="removeFromCart('${item.cartId}')" class="w-8 h-8 bg-red-100 text-red-600 rounded-full flex items-center justify-center hover:bg-red-200 transition-colors">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                  </button>
                </div>
              </div>
            </div>
          `;
        }).join('');
    };
    
    // MODIFIED: This function now accepts the customer's name and notes
    const generateWhatsAppMessage = (customerName, customerNotes) => {
        if (cart.length === 0) return '';
        const mode = document.querySelector('input[name="serviceMode"]:checked')?.value || 'delivery';
        const modeLabel = { dine_in: 'Sur place', delivery: 'Livraison', takeaway: 'À emporter' }[mode];

        let message = `🍽️ *Nouvelle Commande - Qaouti House*\n\n`;
        message += `👤 Nom du client: *${customerName}*\n`;
        message += `🛎️ Mode: *${modeLabel}*\n`;
        
        // Add notes if they exist
        if (customerNotes) {
            message += `📝 Notes: *${customerNotes}*\n`;
        }
        
        message += `\n--- Commande ---\n`;
        
        cart.forEach(item => {
            message += `*${item.quantity}x ${item.name}* (${item.totalPrice} MAD)\n`;
            if (item.choices.mandatoryChoice) message += `   - Choix: ${item.choices.mandatoryChoice}\n`;
            const addons = [...(item.supplements || []), ...(item.upsells || [])];
            if (addons.length > 0) message += `   - Extras: ${addons.join(', ')}\n`;
        });
        const total = cart.reduce((sum, item) => sum + (item.totalPrice * item.quantity), 0);
        message += `\n🎯 *TOTAL: ${total} MAD*\n\nMerci! 🙏`;
        return encodeURIComponent(message);
    };

    const getPopularItems = () => {
      const popularItems = [];
      
      popularItemNames.forEach(popularName => {
        for (const section of menuDataCombined.sections) {
          const foundItem = section.items.find(item => item.name === popularName);
          
          if (foundItem) {
            popularItems.push({
              ...foundItem,
              id: makeItemId(section.name, foundItem.name),
              category: section.name
            });
            break; 
          }
        }
      });
      
      return popularItems;
    };

    const renderItemCard = (item) => {
        const hasCustomizations = item.mandatoryChoice || (item.supplements && item.supplements.length > 0) || (item.upsells && item.upsells.length > 0);
        const onClickHandler = hasCustomizations ? 
            `openAddItemModal('${item.id}')` : 
            `addToCartSimple('${item.id}')`;

        return `
        <div class="menu-card" data-item-id="${item.id}">
            <img src="${getItemImage(item.name, item.category)}" alt="${item.name}" class="menu-card-image" loading="lazy" onerror="this.src='https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400&h=280&fit=crop'">
            <div class="menu-card-overlay"></div>
            <div class="menu-card-content">
              <h3 class="menu-card-title">${item.name}</h3>
              <p class="menu-card-description">${item.description || ''}</p>
              <div class="menu-card-price-container">
                  <p class="menu-card-price">${item.price} MAD</p>
                  <button class="add-to-cart-btn-inline" onclick="${onClickHandler}" aria-label="Ajouter ${item.name}">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                  </button>
              </div>
            </div>
        </div>
        `;
    };

    const renderPopularItems = () => {
        const popularGrid = document.getElementById('popularGrid');
        if (popularGrid) {
            popularGrid.innerHTML = getPopularItems().map(item => renderItemCard(item)).join('');
        }
    };

    // --- CHANGE #7: New function to render promotions ---
    const renderPromotions = () => {
      const promoSection = document.getElementById('promotions');
      const promoGrid = document.getElementById('promotionsGrid');
      
      if (!promoSection || !promoGrid) return;
      
      if (promotionsData.length === 0) {
        promoSection.classList.add('hidden');
        return;
      }
      
      promoSection.classList.remove('hidden');
      promoGrid.innerHTML = promotionsData.map((promo, index) => {
        return `
        <div class="promo-card">
          <img src="${promo.image}" alt="${promo.title}" class="promo-card-image" loading="lazy" onerror="this.src='https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400&h=280&fit=crop'">
          <div class="promo-card-content">
            <h3 class="promo-card-title">${promo.title}</h3>
            <p class="promo-card-description">${promo.description}</p>
            <div class="promo-card-price-container">
              <p class="promo-card-price">${promo.price} MAD</p>
              <button class="add-to-cart-btn-inline" onclick="addPromoToCart(${index})" aria-label="Ajouter ${promo.title}">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
              </button>
            </div>
          </div>
        </div>
        `;
      }).join('');
    };
    
    // --- CHANGE #7: New function to add a promo combo to the cart ---
    const addPromoToCart = (promoIndex) => {
      const promo = promotionsData[promoIndex];
      if (!promo) {
        showToast('Erreur: Promotion non trouvée.', 'error');
        return;
      }
      promo.items.forEach(itemId => {
        const item = findItemById(itemId);
        if (item) {
          addToCart(item); // Adds 1 of each item in the promo
        } else {
          console.error(`Item with ID "${itemId}" from promo "${promo.title}" not found.`);
        }
      });
      showToast(`Promo "${promo.title}" ajoutée!`, 'success');
    };


    const generateFilterButtons = (suffix, menuData) => {
        const container = document.getElementById(`filterScrollContainer-${suffix}`);
        if (!container) return;
        container.innerHTML = '';
        ['Tout', ...menuData.sections.map(s => s.name)].forEach((filter, index) => {
            const isAll = filter === 'Tout';
            const targetId = isAll ? `menu-${suffix}` : `section-${slug(filter)}-${suffix}`;
            const img = isAll ? null : getItemImage(filter, filter);
            
            const btn = document.createElement('button');
            btn.className = `filter-btn${img ? ' filter-btn-image' : ''}${index === 0 ? ' active' : ''}`;
            btn.dataset.filter = isAll ? 'all' : filter;
            btn.dataset.target = targetId;
            if (img) btn.style.backgroundImage = `url('${img}')`;
            btn.innerHTML = `<span>${filter}</span>`;
            container.appendChild(btn);
        });
    };

    const renderMenuSections = (suffix, menuData) => {
        const menuContent = document.getElementById(`menuContent-${suffix}`);
        if (!menuContent) return;
        menuContent.innerHTML = menuData.sections.map(section => `
            <div class="menu-section-items" id="section-${slug(section.name)}-${suffix}" data-section="${section.name}">
                <div class="menu-section-header">
                    <h3 class="menu-section-title">${section.name}</h3>
                    ${section.desc ? `<p class="menu-section-desc">${section.desc}</p>` : ''}
                </div>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                    ${section.items.map(item => renderItemCard({
                        ...item,
                        id: makeItemId(section.name, item.name),
                        category: section.name,
                    })).join('')}
                </div>
            </div>
        `).join('');
    };
    
    // MODIFIED: filterMenuItems to handle the "No Results" message
    const filterMenuItems = (suffix, category = 'all', searchTerm = '') => {
        const sections = document.querySelectorAll(`#menuContent-${suffix} .menu-section-items`);
        let totalVisibleItems = 0;

        sections.forEach(section => {
            const sectionName = section.dataset.section;
            const showSection = category === 'all' || sectionName === category;
            
            if (!showSection) {
                section.style.display = 'none';
                return;
            }

            if (searchTerm) {
                const term = searchTerm.toLowerCase();
                let hasVisibleItems = false;
                section.querySelectorAll('.menu-card').forEach(card => {
                    const title = card.querySelector('.menu-card-title')?.textContent?.toLowerCase() || '';
                    const matches = title.includes(term);
                    card.style.display = matches ? 'flex' : 'none';
                    if (matches) {
                        hasVisibleItems = true;
                        totalVisibleItems++;
                    }
                });
                section.style.display = hasVisibleItems ? 'block' : 'none';
            } else {
                section.style.display = 'block';
                section.querySelectorAll('.menu-card').forEach(card => {
                    card.style.display = 'flex';
                    totalVisibleItems++;
                });
            }
        });

        // CHANGE #2: Logic for "No Results" message
        const noResultsMessage = document.getElementById(`noResultsMessage-${suffix}`);
        if (noResultsMessage) {
            const showMessage = totalVisibleItems === 0 && searchTerm.trim().length > 0;
            noResultsMessage.classList.toggle('hidden', !showMessage);
            if (showMessage) {
                noResultsMessage.querySelector('p:last-child').textContent = `Nous n'avons trouvé aucun plat correspondant à "${searchTerm}".`;
            }
        }
    };
    
    
    // --- UI & Event Handlers ---
    const openCart = () => document.getElementById('cartModal').classList.remove('hidden');
    const closeCart = () => document.getElementById('cartModal').classList.add('hidden');
    const toggleMobileMenu = () => document.getElementById('mobileMenu').classList.toggle('hidden');
    const leaveReview = () => window.open('https://g.page/r/CW_BpVVWMto0EBE/review', '_blank');
    const contactWhatsApp = () => window.open('https://wa.me/212609935865?text=Bonjour!', '_blank');
    const contactCall = () => window.location.href = 'tel:+212609935865';
    const Reclam = () => window.location.href = 'tel:+212661507961';
    const contactGlovo = () => window.open('https://glovoapp.com/ma/fr/rabat/qaouti-house-rab', '_blank');

    const proceedToCheckout = () => {
        if (cart.length === 0) {
            return showToast('Votre panier est vide', 'error');
        }
        openNameModal();
    };

    const openNameModal = () => document.getElementById('nameModal').classList.remove('hidden');
    const closeNameModal = () => document.getElementById('nameModal').classList.add('hidden');

    // MODIFIED: confirmOrderWithName to include special notes
    const confirmOrderWithName = () => {
      const nameInput = document.getElementById('customerNameInput');
      const notesInput = document.getElementById('customerNotesInput');
      const customerName = nameInput.value.trim();
      const customerNotes = notesInput.value.trim();

      if (customerName === '') {
        showToast('Veuillez entrer votre nom', 'error');
        nameInput.focus();
        return;
      }
      
      const message = generateWhatsAppMessage(customerName, customerNotes);
      window.open(`https://wa.me/212609935865?text=${message}`, '_blank');
      closeNameModal();
      nameInput.value = ''; 
      notesInput.value = '';
    };

    const setupEventListenersForSection = (suffix) => {
        const searchInput = document.getElementById(`menuSearch-${suffix}`);
        const filterContainer = document.getElementById(`filterScrollContainer-${suffix}`);

        if (searchInput) {
            searchInput.addEventListener('input', (e) => {
                const activeFilter = filterContainer.querySelector('.filter-btn.active')?.dataset.filter || 'all';
                filterMenuItems(suffix, activeFilter, e.target.value);
            });
        }
        if (filterContainer) {
            filterContainer.addEventListener('click', (e) => {
                const btn = e.target.closest('.filter-btn');
                if (!btn) return;

                filterContainer.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                const searchTerm = searchInput?.value || '';
                filterMenuItems(suffix, btn.dataset.filter, searchTerm);

                const targetId = btn.dataset.target;
                const finalTargetId = targetId === 'menu-unified' ? 'menu-unified' : `section-${slug(btn.dataset.filter)}-unified`;
                const targetEl = document.getElementById(finalTargetId);

                if (targetEl && btn.dataset.filter !== 'all') {
                    const headerOffset = 90; 
                    const elementPosition = targetEl.getBoundingClientRect().top;
                    const offsetPosition = elementPosition + window.pageYOffset - headerOffset;

                    window.scrollTo({
                        top: offsetPosition,
                        behavior: "smooth"
                    });
                }
            });
        }
    };
    
    // --- App Initialization ---
    const initializeApp = () => {
      try {
        renderPromotions(); // Render promotions first
        initializeMenuSection('unified', menuDataCombined);
        renderPopularItems();
        updateCartCount();
        initializeAdminPanel();

        ['cartModal', 'addItemModal', 'nameModal'].forEach(id => {
            const modal = document.getElementById(id);
            if(modal) modal.addEventListener('click', e => { if (e.target === modal) modal.classList.add('hidden'); });
        });
        
        console.log('✅ App initialized successfully');
      } catch (error) {
        console.error('Error initializing app:', error);
      }
    };

    const initializeMenuSection = (suffix, menuData) => {
        renderMenuSections(suffix, menuData);
        generateFilterButtons(suffix, menuData);
        setupEventListenersForSection(suffix);
    };

    Object.assign(window, {
        addToCart, addToCartSimple, openAddItemModal, closeAddItemModal, updateModalQuantity,
        addItemFromModal, updateCartItemQuantity, removeFromCart, clearCart, openCart,
        closeCart, proceedToCheckout, toggleMobileMenu, leaveReview, contactWhatsApp,
        contactCall, contactGlovo, Reclam, updateCrossSellQuantity, addPromoToCart,
        openNameModal, closeNameModal, confirmOrderWithName
    });

    document.addEventListener('DOMContentLoaded', initializeApp);
  </script>
</body>
</html>