<!DOCTYPE html>
<html lang="fr">
<head>
  <link rel="icon" href="assets/logo-white.png" type="image/png">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Qaouti House ‚Äì Restaurant , Fast Food & Snack</title>
  <meta name="description" content="Qaouti House ‚Äì Restaurant , Fast Food & Snack. Situ√© √† Rabat. Commande WhatsApp et sur place." />
  <meta property="og:title" content="Qaouti House ‚Äì Restaurant , Fast Food & Snack" />
  <meta property="og:description" content="Restaurant , Fast Food & Snack √† Rabat. Commande via WhatsApp, t√©l√©phone, ou sur place." />
  <meta property="og:type" content="website" />
  <meta property="og:locale" content="fr_MA" />
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Task 1: Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Kaushan+Script&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Task 1: Kaushan Script Font */
    .kaushan-script-regular {
      font-family: "Kaushan Script", cursive;
      font-weight: 400;
      font-style: normal;
    }
      /* Your existing styles... */
  
  /* Custom header background */
  .custom-header {
    background: linear-gradient(90deg, #21a13b 0%, #07a96b 100%);
  }
  
  /* Or solid color */
  .header-custom-bg {
    background-color: #126127;
  }
    html { scroll-behavior: smooth; }
    .no-scrollbar::-webkit-scrollbar { display: none; } .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    :root {
      /* Main Theme Colors */
      --bg: #a3d9b3; /* Light earthy beige */
      --surface: #ffffff; /* White for cards */
      --ink: #3E2723; /* Dark earthy brown for text */
      --primary: #004d40; /* Deep forest green */
      --primary-ink: #afc9af; /* Text on green buttons */
      --ring: #e4f0e2; /* Light green for borders */
      
      /* Accent Colors */
      --accent-glovo: #FFC244; /* Specific yellow for Glovo */
      --accent-review: #e98708; /* Blue for the review button */

      /* Misc */
      --muted: #64748B;
      --ok: #16A34A;
      --warn: #EF4444;
    }
    body{ background:var(--bg); color:var(--ink); }
    @media (prefers-reduced-motion: no-preference){
      .cart-bounce{ animation: cartBounce .5s ease; }
      @keyframes cartBounce { 0%,100%{transform:translateY(0)} 40%{transform:translateY(-8px)} 60%{transform:translateY(-4px)} }
      .toast.hide{ animation: fadeOut .25s forwards; }
      @keyframes fadeOut { to{ opacity:0; transform:translate(-50%, 8px);} }
    }
    .toast{ position:fixed; left:50%; bottom:24px; transform:translateX(-50%); z-index:80; background:#fff; border:1px solid var(--ring); box-shadow:0 8px 30px rgba(0,0,0,.08); padding:10px 14px; border-radius:12px; display:flex; align-items:center; gap:8px; font-weight:600; }
    .chip{ display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; border:1px solid var(--ring); background:#fff; font-size:12px; }
    .shadow-soft{ box-shadow:0 1px 2px rgba(0,0,0,.05), 0 8px 24px rgba(0,0,0,.05); }
    .ring-soft{ box-shadow: inset 0 0 0 1px var(--ring); }
    #heroLeftCard{ background:var(--primary); color:var(--primary-ink); }
    #locations{ background:#4c3d3d; color:#ffffff; }
    #locations a, #locations button{ color:#abd2b8; }
    #contact{ background:linear-gradient(180deg, #232323 0%, #1a1a1a 100%); color:#fff; }
    #floatingCartBtn{
      position:fixed; right:16px; bottom:16px; z-index:70;
      background:var(--primary); color:var(--primary-ink);
      border-radius:999px; padding:12px 16px; box-shadow:0 8px 30px rgba(0,0,0,.15);
      display:flex; align-items:center; gap:8px; font-weight:700;
    }
    #floatingCartBtn.hidden{ display:none; }
    .trap-start, .trap-end { width:0; height:0; overflow:hidden; position:fixed; }

    /* Bigger images like the Quickly file */
    .card-img{
      width:100%;
      height:220px;              /* was 160px */
      object-fit:cover;
      object-position:center;
      border-radius:16px;        /* a bit rounder */
      margin-bottom:12px;
      box-shadow:0 1px 2px rgba(0,0,0,.04);
      border:1px solid var(--ring);
      background:#fff;
    }
    @media (min-width:768px){
      .card-img{ height:300px; } /* make them larger on desktop */
    }
  </style>
</head>
<body class="text-slate-800">
  <a href="#main" class="sr-only focus:not-sr-only focus:fixed focus:z-50 focus:top-2 focus:left-2 bg-black text-white px-3 py-2 rounded">Aller au contenu</a>

  <!-- Task 3: Header without border -->
  <header class="sticky top-0 z-30 custom-header backdrop-blur">
    <div class="max-w-6xl mx-auto flex items-center justify-between px-4 py-3">
      <div class="flex items-center gap-3">
        <img id="brandLogo" src="assets/logo-white.png" alt="Qaouti House" class="h-10 w-10 rounded-lg object-contain" onerror="this.style.display='none'"/>
        <div class="leading-tight">
          <h1 class="text-xl font-extrabold tracking-tight kaushan-script-regular text-center text-white ">Qaouti House</h1>
          <p id="taglineSmall" class="text-xs text-white/70 hidden"></p>
        </div>
      </div>

      <!-- Desktop Navigation -->
      <nav class="hidden md:flex items-center gap-6 text-sm text-white">
        <a href="#menu" class="hover:text-white/80">Menu</a>
        <a href="#locations" class="hover:text-white/80">Adresse</a>
        <div class="flex items-center gap-2">
          <button type="button" class="px-2 py-1 text-xs rounded border border-white/30 text-white hover:bg-white/10" onclick="setLang('fr')">FR</button>
          <button type="button" class="px-2 py-1 text-xs rounded border border-white/30 text-white hover:bg-white/10" onclick="setLang('en')">EN</button>
          <button type="button" class="px-2 py-1 text-xs rounded border border-white/30 text-white hover:bg-white/10" onclick="setLang('ar')">AR</button>
        </div>
      </nav>
    </div>

    <!-- Mobile Menu Overlay -->
    <div id="mobileMenuOverlay" class="fixed inset-0 bg-black/50 z-40 hidden" onclick="toggleMobileMenu()"></div>
  </header>

  <section id="home" class="relative overflow-hidden">
  <div class="absolute inset-0">
    <img id="heroBgImage" src="assets/hero.png" alt="" class="w-full h-full object-cover opacity-20" loading="eager" decoding="async" />
    <div class="absolute inset-0 bg-[color:#004d40]/80"></div>
  </div>
  <div class="relative">
    <div class="max-w-6xl mx-auto grid md:grid-cols-2 gap-8 px-4 py-10 md:py-16">
      <div class="flex flex-col justify-center">
        <img id="heroLogoImage" src="assets/qaouti-house.png" alt="Qaouti House" class="h-[200px] md:h-300 w-auto object-contain mx-auto" onerror="this.style.display='none'"/>
      </div>
      
      <div class="flex flex-col justify-center items-center">
        
        <h2 class="text-5xl md:text-6xl font-extrabold leading-tight text-white kaushan-script-regular text-center">Qaouti House</h2>
        
        <p id="tagline" class="text-lg text-white mt-2 hidden text-center"></p>

        <div class="mt-6 grid md:grid-cols-4 gap-3">
          <div class="relative">
            <button id="heroGlovo" type="button" class="h-12 w-full rounded-xl font-semibold shadow-soft flex items-center justify-center" style="background-color: var(--accent-glovo); color: var(--ink);" data-i18n="order_glovo">Commander sur Glovo</button>
          </div>
          <div class="relative">
            <button id="heroCallBtn" type="button" class="h-12 w-full rounded-xl bg-slate-800 text-white font-semibold shadow-soft flex items-center justify-center" data-i18n="call">Appeler</button>
          </div>
          <div class="relative">
            <button id="heroWhatsAppBtn" type="button" class="h-12 w-full rounded-xl bg-emerald-600 text-white font-semibold shadow-soft flex items-center justify-center" data-i18n="whatsapp">WhatsApp</button>
          </div>
          <div class="relative">
            <a href="https://g.page/r/CW_BpVVWMto0EBE/review" target="_blank" rel="noopener" class="h-12 w-full rounded-xl font-semibold shadow-soft flex items-center justify-center" style="background-color: var(--accent-review); color: white;">Laisser un avis</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

  <section id="popular" class="py-10 md:py-12 bg-white border-y">
    <div class="max-w-6xl mx-auto px-4">
      <div class="flex items-end justify-between mb-4">
        <h3 class="text-2xl font-extrabold tracking-tight kaushan-script-regular text-center" data-i18n="popular">Populaire</h3>
        <a href="#menu" class="text-sm underline" data-i18n="see_menu">Voir le menu</a>
      </div>
      <div id="popularList" class="flex gap-4 overflow-x-auto no-scrollbar pb-2"></div>
    </div>
  </section>

  <main id="main">
    <section id="menu" class="py-12 md:py-16">
      <div class="max-w-6xl mx-auto px-4">
        <h3 class="text-2xl font-extrabold tracking-tight kaushan-script-regular text-white">Menu</h3>
        <div id="menuTabs" class="flex overflow-x-auto no-scrollbar gap-4 pb-2 mb-6 md:grid md:grid-cols-5 lg:grid-cols-6 xl:grid-cols-7 md:gap-6"></div>
        <div id="menuContent" class="grid md:grid-cols-2 gap-6"></div>
      </div>
    </section>

    <section id="locations" class="py-12 border-t">
      <div class="max-w-6xl mx-auto px-4">
        <h3 class="text-2xl font-extrabold tracking-tight kaushan-script-regular text-center mb-6">Adresse & horaires</h3>
        <div id="locationCards" class="grid md:grid-cols-1 gap-6"></div>
      </div>
    </section>
  </main>
  <section id="reviews" class="py-12 md:py-16 bg-green">
    <div class="max-w-6xl mx-auto px-4">
      <h3 class="text-2xl font-extrabold tracking-tight kaushan-script-regular text-center text-white">Ce que disent nos clients</h3>
      
      <div class="taggbox" style="width:100%;height:100%;overflow:auto;" data-widget-id="298164" data-website="1"></div>
      <script src="https://widget.taggbox.com/embed.min.js" type="text/javascript"></script>
  
    </div>
  </section>

  <footer class="border-t bg-[color:#141412]">
    <div class="max-w-6xl mx-auto px-4 py-8 flex flex-col md:flex-row items-center justify-between gap-4">
      <div class="flex items-center gap-2">
        <a class="p-2 rounded-lg border bg-white shadow-soft" href="https://www.instagram.com/qaoutihouse/?hl=fr" target="_blank" rel="noopener noreferrer" aria-label="Instagram">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" aria-hidden="true">
            <linearGradient id="ig" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#F58529"/><stop offset="30%" stop-color="#DD2A7B"/><stop offset="60%" stop-color="#8134AF"/><stop offset="100%" stop-color="#515BD4"/>
            </linearGradient>
            <path fill="url(#ig)" d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm0 2a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a 3 3 0 0 0 3-3V7a3 3 0 0 0-3-3H7zm5 3.5a5.5 5.5 0 1 1 0 11 5.5 5.5 0 0 1 0-11zm0 2a3.5 3.5 0 1 0 0 7 3.5 3.5 0 0 0 0-7zm5.75-.75a1.25 1.25 0 1 1 0 2.5 1.25 1.25 0 0 1 0-2.5z"/>
          </svg>
        </a>
      </div>

      <p class="text-sm text-slate-500">¬© <span id="year"></span> Qaouti House ‚Ä¢ Rabat</p>

      <div class="flex flex-col md:flex-row items-center gap-3 md:gap-6">
        <ul class="flex flex-wrap gap-2 text-xs">
        </ul>
      </div>
    </div>
    <button id="contactGlovo" type="button" class="hidden" aria-hidden="true"></button>
  </footer>

  <button id="floatingCartBtn" type="button" class="hidden" aria-label="Voir panier">
    <span id="floatCartCount" class="inline-flex items-center justify-center w-6 h-6 text-xs font-bold bg-white rounded-full">0</span>
    <span data-i18n="view_cart">Voir panier</span>
    <span id="floatCartTotal" class="font-semibold"></span>
  </button>

  <dialog id="cartModal" class="backdrop:bg-black/50 rounded-2xl p-0 w-[95%] md:w-[640px] max-h-[90vh] overflow-y-auto" aria-labelledby="cartTitle" aria-describedby="cartDesc">
    <span class="trap-start" tabindex="0"></span>
    <div class="p-6 bg-white rounded-2xl">
      <div class="flex items-center justify-between mb-4">
        <h4 id="cartTitle" class="text-lg font-bold" data-i18n="cart">Panier</h4>
        <button type="button" onclick="closeCart()" class="text-slate-500" aria-label="Fermer">‚úï</button>
      </div>
      <p id="cartDesc" class="sr-only">Contenu du panier et validation de la commande.</p>
      <div id="cartItems" class="space-y-3 max-h-[50vh] overflow-y-auto"></div>
      <div id="cartEmpty" class="text-center py-8 text-slate-500 hidden">
        <p data-i18n="cart_empty">Votre panier est vide</p>
      </div>
      <div id="cartFooter" class="border-t pt-4 mt-4 hidden">
        <div class="flex justify-between items-center mb-4">
          <span class="font-bold text-lg" data-i18n="total">Total:</span>
          <span id="cartTotal" class="font-bold text-lg">0 MAD</span>
        </div>

        <!-- New service mode choice (Sur place / Livraison) -->
        <div class="mb-4">
          <span class="block text-sm font-medium mb-2" data-i18n="service_mode">Mode de service</span>
          <div class="flex gap-4">
            <label class="inline-flex items-center gap-2">
              <input type="radio" name="serviceMode" value="Sur place">
              <span data-i18n="dine_in">Sur place</span>
            </label>
            <label class="inline-flex items-center gap-2">
              <input type="radio" name="serviceMode" value="Livraison" checked>
              <span data-i18n="delivery">Livraison</span>
            </label>
            <label class="inline-flex items-center gap-2">
              <input type="radio" name="serviceMode" value="En voiture" checked>
              <span data-i18n="Drive By">En voiture</span>
            </label>
          </div>
        </div>

        <div class="flex gap-2">
          <button type="button" onclick="clearCart()" class="px-4 py-2 rounded-lg border text-sm">Vider panier</button>
          <button type="button" onclick="sendWhatsAppOrder()" class="flex-1 px-4 py-2 rounded-lg bg-emerald-600 text-white font-semibold" data-i18n="send_order">Finaliser la commande</button>
        </div>
      </div>
    </div>
    <span class="trap-end" tabindex="0"></span>
  </dialog>

  <dialog id="addToCartModal" class="backdrop:bg-black/50 rounded-2xl p-0 w-[95%] md:w-[520px]" aria-labelledby="addToCartTitle">
    <span class="trap-start" tabindex="0"></span>
    <div class="p-6 bg-white rounded-2xl">
      <div class="flex items-center justify-between mb-4">
        <h4 id="addToCartTitle" class="text-lg font-bold"></h4>
        <button type="button" onclick="closeAddToCart()" class="text-slate-500" aria-label="Fermer">‚úï</button>
      </div>
      <div id="addToCartContent"></div>
      <div class="flex items-center justify-between mt-6">
        <div class="flex items-center gap-3">
          <button type="button" onclick="decreaseQuantity()" class="w-8 h-8 rounded-full border flex items-center justify-center">-</button>
          <span id="quantity" class="font-semibold">1</span>
          <button type="button" onclick="increaseQuantity()" class="w-8 h-8 rounded-full border flex items-center justify-center">+</button>
        </div>
        <button type="button" onclick="addToCart()" class="px-6 py-2 rounded-lg bg-[color:var(--primary)] text-[color:var(--primary-ink)] font-semibold ring-soft shadow-soft" data-i18n="add_to_cart">Ajouter au panier</button>
      </div>
    </div>
    <span class="trap-end" tabindex="0"></span>
  </dialog>

  <dialog id="glovoModal" class="backdrop:bg-black/50 rounded-2xl p-0 w-[95%] md:w-[420px]" aria-labelledby="glovoTitle">
    <div class="p-6 bg-white rounded-2xl">
      <div class="flex items-center justify-between mb-3">
        <h4 id="glovoTitle" class="text-lg font-bold">Commander sur Glovo</h4>
        <button type="button" onclick="document.getElementById('glovoModal').close()" class="text-slate-500" aria-label="Fermer">‚úï</button>
      </div>
      <p class="text-sm text-slate-600 mb-4">Commander sur Glovo ?</p>
      <div id="glovoChoices" class="grid gap-2"></div>
    </div>
  </dialog>

  <div id="toastWrap"></div>

  <script>
    // Centralized image configuration (edit here to change any photo)
    const IMAGE_CFG = {
      brand: {
        logo: "assets/logo-white.png",
        hero_logo: "assets/qaouti-house.png"
      },
      hero: {
        bg: "assets/hero.png"
      },
      categories: {
        "Plats":"assets/burgers.jpg",
        "Poulet Croustillant":"assets/burgers.jpg",
        "Les P√¢tes Thailandaises":"assets/extras.jpg",
        "Les Wok Thailandaises":"assets/extras.jpg",
        "Pasticcio ou Poutine":"assets/extras.jpg",
        "Tajine":"assets/extras.jpg",
        "Burger":"assets/burgers.jpg",
        "Tacos + Frites":"assets/tacos.jpg",
        "Pizza":"assets/burgers.jpg",
        "Ciabata + Frite":"assets/wraps.jpg",
        "Les Longs + Frites":"assets/wraps.jpg",
        "Kumpir":"assets/extras.jpg",
        "Les P√¢tes":"assets/extras.jpg",
        "Cr√™pes Sucr√©es":"assets/desserts.jpg",
        "Cr√™pes Sal√©es":"assets/desserts.jpg",
        "Dessert":"assets/desserts.jpg",
        "Jus":"assets/boissons.jpg"
      },
      fallbacks: {
        categories: {
          "Plats":"https://images.unsplash.com/photo-1550547660-d9450f859349?q=80&w=1200&auto=format&fit=crop",
          "Poulet Croustillant":"https://images.unsplash.com/photo-1550547660-d9450f859349?q=80&w=1200&auto=format&fit=crop",
          "Les P√¢tes Thailandaises":"https://sausagemaker.com/wp-content/uploads/Homemade-French-Fries_8.jpg",
          "Les Wok Thailandaises":"https://sausagemaker.com/wp-content/uploads/Homemade-French-Fries_8.jpg",
          "Pasticcio ou Poutine":"https://sausagemaker.com/wp-content/uploads/Homemade-French-Fries_8.jpg",
          "Tajine":"https://sausagemaker.com/wp-content/uploads/Homemade-French-Fries_8.jpg",
          "Burger":"https://images.unsplash.com/photo-1550547660-d9450f859349?q=80&w=1200&auto=format&fit=crop",
          "Tacos + Frites":"https://french-iceberg.com/wp-content/uploads/2021/05/French-Taco-scaled.jpg.webp",
          "Pizza":"https://images.unsplash.com/photo-1550547660-d9450f859349?q=80&w=1200&auto=format&fit=crop",
          "Ciabata + Frite":"https://tropicaleatandmore.com/wp-content/uploads/2020/09/Chicken-Tender-wrap.jpeg",
          "Les Longs + Frites":"https://tropicaleatandmore.com/wp-content/uploads/2020/09/Chicken-Tender-wrap.jpeg",
          "Kumpir":"https://sausagemaker.com/wp-content/uploads/Homemade-French-Fries_8.jpg",
          "Les P√¢tes":"https://sausagemaker.com/wp-content/uploads/Homemade-French-Fries_8.jpg",
          "Cr√™pes Sucr√©es":"https://www.laguildeculinaire.com/cdn/shop/articles/lgc-recette-verrine-de-tiramisu-1024x640_600x600_crop_center.jpg?v=1583187754",
          "Cr√™pes Sal√©es":"https://www.laguildeculinaire.com/cdn/shop/articles/lgc-recette-verrine-de-tiramisu-1024x640_600x600_crop_center.jpg?v=1583187754",
          "Dessert":"https://www.laguildeculinaire.com/cdn/shop/articles/lgc-recette-verrine-de-tiramisu-1024x640_600x600_crop_center.jpg?v=1583187754",
          "Jus":"https://www.beanilla.com/wp/wp-content/uploads/2022/06/RefreshingDrinks-1024x683.jpg"
        },
        location: "assets/qaouti-storefront.png"
      }
    };

    // ====== DATA ======
    const DATA = {
      brand: {
        name: "Qaouti House",
        tagline_fr: "Restaurant , Fast Food & Snack",
        tagline_en: "Caf√©, Restaurant & Patisserie",
        tagline_ar: "ŸÖŸÇŸáŸâ ŸàŸÖÿ∑ÿπŸÖ Ÿàÿ≠ŸÑŸàŸäÿßÿ™",
        logo: "assets/qaouti-house.png"
      },
      languages_enabled: ["fr","en","ar"],
      locations: [
        {
          id: "l1",
          name: "Qaouti House",
          image: "assets/qaouti-storefront.png",
          address: "Avenue Al Massira, 482 Av. Al Menzeh, Rabat 10052",
          maps_url: "https://maps.app.goo.gl/euuUBF24tAV2VrJT7",
          phone: "+212661507961",
          whatsapp: "https://wa.me/212661507961",
          glovo_url: "https://glovoapp.com/ma/fr/rabat/qaouti-house-2-rbt/",
          hours: { lundi: "11:00‚Äì00:45", mardi: "11:00‚Äì00:45", mercredi: "11:00‚Äì00:45", jeudi: "11:00‚Äì00:45", vendredi: "11:00‚Äì00:45", samedi: "11:00‚Äì00:30", dimanche: "11:00‚Äì00:45" }
        }
      ],
      ui: {
        fr: {
          order_glovo:"Commander sur Glovo", call:"Appeler", whatsapp:"WhatsApp", see_menu:"Voir le menu",
          directions:"Localisation", hours:"Horaires", popular:"Populaire", halal:"Halal", add_to_cart:"Ajouter au panier",
          cart:"Panier", view_cart:"Voir panier", cart_empty:"Votre panier est vide", total:"Total", clear_cart:"Vider panier",
          send_order:"Finaliser la commande", select_location:"Choisir le restaurant", size:"Taille", sauce:"Sauce",
          supplements:"Suppl√©ments", gratin:"Gratin",
          service_mode:"Mode de service", dine_in:"Sur place", delivery:"Livraison" ,
        },
        en: {
          order_glovo:"Order on Glovo", call:"Call", whatsapp:"WhatsApp", see_menu:"View Menu",
          directions:"Location", hours:"Hours", popular:"Popular", halal:"Halal", add_to_cart:"Add to cart",
          cart:"Cart", view_cart:"View cart", cart_empty:"Your cart is empty", total:"Total", clear_cart:"Clear cart",
          send_order:"Send order", select_location:"Select restaurant", size:"Size", sauce:"Sauce",
          supplements:"Supplements", gratin:"Gratin",
          service_mode:"Service mode", dine_in:"Dine-in", delivery:"Delivery"
        },
        ar: {
          order_glovo:"ÿßÿ∑ŸÑÿ® ÿπÿ®ÿ± ÿ∫ŸÑŸàŸÅŸà", call:"ÿßÿ™ÿµÿßŸÑ", whatsapp:"Ÿàÿßÿ™ÿ≥ÿßÿ®", see_menu:"ÿπÿ±ÿ∂ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©",
          directions:"ÿßŸÑŸÖŸàŸÇÿπ", hours:"ÿ≥ÿßÿπÿßÿ™ ÿßŸÑÿπŸÖŸÑ", popular:"ÿßŸÑÿ£ŸÉÿ´ÿ± ÿ∑ŸÑÿ®Ÿãÿß", halal:"ÿ≠ŸÑÿßŸÑ", add_to_cart:"ÿ£ÿ∂ŸÅ ŸÑŸÑÿ≥ŸÑÿ©",
          cart:"ÿßŸÑÿ≥ŸÑÿ©", view_cart:"ÿπÿ±ÿ∂ ÿßŸÑÿ≥ŸÑÿ©", total:"ÿßŸÑŸÖÿ¨ŸÖŸàÿπ", clear_cart:"ÿ•ŸÅÿ±ÿßÿ∫ ÿßŸÑÿ≥ŸÑÿ©",
          send_order:"ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ®", select_location:"ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ∑ÿπŸÖ", size:"ÿßŸÑÿ≠ÿ¨ŸÖ", sauce:"ÿßŸÑÿµŸÑÿµÿ©",
          supplements:"ÿßŸÑÿ•ÿ∂ÿßŸÅÿßÿ™", gratin:"ÿßŸÑÿ¨ÿ±ÿßÿ™ÿßŸÜ",
          service_mode:"ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿÆÿØŸÖÿ©", dine_in:"ÿ™ŸÜÿßŸàŸÑ ŸÅŸä ÿßŸÑŸÖÿ∑ÿπŸÖ", delivery:"ÿ™ŸàÿµŸäŸÑ"
        }
      },
      menu: {
        currency: "MAD",
        popular_section: "Plats",
        sections: [
          {
            name: "Plats",
            desc: "Servi avec l√©gumes, pur√©e, ou frites",
            items: [
              { name: "Eminc√© de Poulet", price: 50 },
              { name: "Eminc√© de Boeuf", price: 60 },
              { name: "Poulet √† la Tarascon", price: 60 },
              { name: "Poulet India", price: 55 }
            ],options: {Jus:[{ name:"Jus de choix", price:20 },
                { name:"Jus d'Orange", price:15 },
                { name:"Jus de Citron", price:12 },
                { name:"Panach√©", price:20 },],
              Dessert:[{ name:"Tiramisu", price:20 },
                { name:"Cheesecake", price:20 }]},
          },
          {
            name: "Poulet Croustillant",
            desc: "Servi avec penne ou frites",
            items: [
              { name: "Escalope (Curry)", price: 66 },
              { name: "Cordon Bleu", price: 55 },
              { name: "Tenders", price: 45 }
            ]
          },
          {
            name: "Les P√¢tes Thailandaises",
            items: [
              { name: "Poulet", price: 45 },
              { name: "Gambas", price: 55 },
              { name: "Boeuf", price: 60 },
              { name: "V√©g√©tarienne", price: 35 }
            ]
          },
          {
            name: "Les Wok Thailandaises",
            items: [
              { name: "Wok Poulet", price: 50 },
              { name: "Wok Boeuf", price: 65 },
              { name: "Wok Gamba", price: 60 },
              { name: "Poulet Teriyaki", price: 50 }
            ]
          },
          {
            name: "Pasticcio ou Poutine",
            items: [
              { name: "Hot Dog", price: 35 },
              { name: "Dinde Fum√©", price: 35 },
              { name: "Poulet", price: 37 },
              { name: "Viande Hach√©e", price: 37 },
              { name: "Nuggets", price: 37 },
              { name: "Mixte", price: 45 },
              { name: "Fruits de mer", price: 45 },
              { name: "Cordon Bleu", price: 45 }
            ]
          },
          {
            name: "Tajine",
            items: [
              { name: "Viande Hach√©e", price: 35 },
              { name: "Crevette pil pil", price: 40 },
              { name: "Fruits de mer", price: 40 }
            ]
          },
          {
            name: "Burger",
            desc: "Sauce, oignon, tomate, laitue, fromage",
            items: [
              { name: "Chicken Crispy", price: 35 },
              { name: "Cheese Burger", price: 38 },
              { name: "Chicken", price: 38 },
              { name: "Big King", price: 45 },
              { name: "Egg Burger", price: 40 },
              { name: "Burger XXXL", price: 55 },
              { name: "Mozzarella Steak", price: 50 },
              { name: "Onion", price: 45 },
              { name: "Chilly Cheese", price: 48 }
            ]
          },
          {
            name: "Tacos + Frites",
            items: [
              { name: "Poulet", price: 40 },
              { name: "Nuggets", price: 40 },
              { name: "Mixte", price: 45 },
              { name: "Viande Hach√©e", price: 40 },
              { name: "Cordon Bleu", price: 45 },
              { name: "Hot Dog", price: 35 },
              { name: "Fruits de mer", price: 45 },
              { name: "Pepperoni", price: 40 }
            ],
            options: {
              supplements: [
                { name: "Gratin√©", price: 10 },
                { name: "Frommage", price: 5 },
                { name: "Sauce", price: 3 }
              ]
            }
          },
          {
            name: "Pizza",
            items: [
              { name: "Margarita", price: 30 },
              { name: "V√©g√©tarienne", price: 37 },
              { name: "Hot Dog", price: 37 },
              { name: "Charcuterie", price: 37 },
              { name: "Jambon", price: 37 },
              { name: "Poulet", price: 37 },
              { name: "Viande Hach√©e", price: 37 },
              { name: "Thon", price: 37 },
              { name: "Quatre Saisons", price: 45 },
              { name: "Mixte", price: 45 },
              { name: "Fruits de mer", price: 45 },
              { name: "Pepperoni", price: 37 },
              { name: "Galzones", price: 45 }
            ]
          },
          {
            name: "Ciabata + Frite",
            desc: "Oignon, tomate, laitue, frommage",
            items: [
              { name: "Thon", price: 25 },
              { name: "Poulet", price: 30 },
              { name: "Viande Hach√©e", price: 32 },
              { name: "Mixte", price: 35 },
              { name: "Fruits de mer", price: 35 }
            ]
          },
          {
            name: "Les Longs + Frites",
            desc: "Sauce, oignon, tomate, laitue, frommage",
            items: [
              { name: "Chicken", price: 35 },
              { name: "Chicken Crispy", price: 38 },
              { name: "Cordon Bleu", price: 40 },
              { name: "Viande Hach√©e", price: 38 }
            ]
          },
          {
            name: "Kumpir",
            items: [
              { name: "Fruits de mer", price: 45 },
              { name: "Kebab", price: 40 },
              { name: "Thonioli", price: 35 },
              { name: "Salata", price: 40 },
              { name: "House", price: 45 },
              { name: "Fromage", price: 25 }
            ]
          },
          {
            name: "Les P√¢tes",
            desc: "Spaghetti - Penne - Tagliatelle",
            items: [
              { name: "Pur√©e Gratin", price: 18 },
              { name: "Gratin Macaroni", price: 25 },
              { name: "Carbonara", price: 40 },
              { name: "Poulet", price: 40 },
              { name: "Bolognaise", price: 48 },
              { name: "Fruits de mer", price: 50 },
              { name: "Lasagnes", price: 48 }
            ]
          },
          {
            name: "Cr√™pes Sucr√©es",
            items: [
              { name: "Caramel", price: 20 },
              { name: "Nutella", price: 20 },
              { name: "Kinder Bueno", price: 35 },
              { name: "3 Chocolats", price: 30 },
              { name: "Browni 3 Chocolats", price: 35 },
              { name: "3 Fruits", price: 30 },
              { name: "Roul√©e Sp√©culos", price: 35 },
              { name: "Roul√©e (Banane)", price: 35 },
              { name: "Gourmand (Oreo, Fruits, Banane)", price: 40 }
            ]
          },
          {
            name: "Cr√™pes Sal√©es",
            items: [
              { name: "Eminc√© de Poulet", price: 35 },
              { name: "Carbonara", price: 30 },
              { name: "Fruits de mer", price: 40 },
              { name: "Steak Hach√©", price: 40 }
            ]
          },
          {
            name: "Dessert",
            items: [
              { name: "Tiramisu", price: 20 },
              { name: "Cheesecake", price: 20 },
              { name: "Boisson 0.33 cl", price: 15 },
              { name: "Eau min√©rale 0.5 cl", price: 5 },
              { name: "Oulmes 0.5 cl", price: 9 }
            ]
          },
          {
            name: "Jus",
            items: [
              { name: "Jus de Choix", price: 20 },
              { name: "Jus d'Orange", price: 15 },
              { name: "Jus de Citron", price: 12 },
              { name: "Panach√©", price: 20 }
            ]
          }
        ]
      }
    };

    // ====== Cart state ======
    let cart = [];
    try { cart = JSON.parse(localStorage.getItem('qaouti_cart') || '[]'); } catch(e){ cart = []; }
    let currentItem = null;
    let currentQuantity = 1;

    // i18n
    function t(key){ return (DATA.ui[LANG] && DATA.ui[LANG][key]) || (DATA.ui['fr'] && DATA.ui['fr'][key]) || key; }
    let LANG = 'fr';
    function applyHtmlLangDir(){
      const html = document.documentElement;
      html.lang = LANG;
      html.dir = (LANG==='ar' ? 'rtl' : 'ltr');
    }
    function setLang(l){
      LANG = l; applyHtmlLangDir();
      try{ localStorage.setItem('qaouti_lang', LANG); }catch(e){}
      renderAll();
    }

    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
    const fmt = (v)=> new Intl.NumberFormat(LANG==='ar'?'ar-MA':(LANG==='en'?'en-US':'fr-MA'), { style:'currency', currency:'MAD' }).format(v||0);
    function money(v){ return v==null?'-':fmt(v); }

    function saveCart(){ try{ localStorage.setItem('qaouti_cart', JSON.stringify(cart)); }catch(e){} updateCartUI(); }
    function updateCartUI(){
      const btn = $('#floatingCartBtn');
      const count = cart.reduce((n,i)=>n+i.quantity,0);
      const total = cart.reduce((n,i)=>n+i.price*i.quantity,0);
      $('#floatCartCount').textContent = count;
      $('#floatCartTotal').textContent = count ? `¬∑ ${money(total)}` : '';
      btn.classList.toggle('hidden', count===0);
    }

    function showToast(msg, type='ok'){
      const wrap = document.getElementById('toastWrap');
      const el = document.createElement('div');
      el.className = 'toast';
      el.innerHTML = type==='ok'
        ? `<span>‚úÖ</span><span>${msg}</span>`
        : `<span>üóëÔ∏è</span><span>${msg}</span>`;
      wrap.appendChild(el);
      setTimeout(()=>{ el.classList.add('hide'); setTimeout(()=>el.remove(), 260); }, 1000);
    }

    function generateCartId(item, section){ return `${section.name}-${item.name}-${JSON.stringify(item.selectedOptions || {})}`; }

    function openCart(){ renderCart(); $('#cartModal').showModal(); $('#cartModal').focus(); }
    function closeCart(){ $('#cartModal').close(); }

    function clearCart(){
      if (confirm('√ätes-vous s√ªr de vouloir vider le panier?')) {
        cart = [];
        saveCart(); renderCart();
        showToast('Panier vid√©', 'del');
      }
    }
    function removeFromCart(index){
      cart.splice(index,1); saveCart(); renderCart();
      showToast('Supprim√© avec succ√®s', 'del');
    }
    function updateCartQuantity(index, newQty){
      if(newQty<=0){ removeFromCart(index); return; }
      cart[index].quantity = newQty; saveCart(); renderCart();
    }

    function renderCart(){
      const itemsEl = $('#cartItems');
      const emptyEl = $('#cartEmpty');
      const footerEl = $('#cartFooter');
      if(cart.length===0){ itemsEl.innerHTML=''; emptyEl.classList.remove('hidden'); footerEl.classList.add('hidden'); return; }
      emptyEl.classList.add('hidden'); footerEl.classList.remove('hidden');
      let total = 0;
      itemsEl.innerHTML = cart.map((item, idx)=>{
        const itemTotal = item.price * item.quantity; total += itemTotal;
        const optionsText = item.selectedOptions ? Object.entries(item.selectedOptions)
          .filter(([k,v])=>v && v!=='').map(([k,v])=>`${k}: ${Array.isArray(v)?v.join(', '):v}`).join(' ‚Ä¢ ') : '';
        return `
          <div class="border rounded-lg p-3 bg-white shadow-sm">
            <div class="flex justify-between items-start mb-2">
              <div>
                <h5 class="font-semibold">${item.name}</h5>
                <p class="text-sm text-slate-600">${item.section}</p>
                ${optionsText ? `<p class="text-xs text-slate-500">${optionsText}</p>` : ''}
              </div>
              <button type="button" onclick="removeFromCart(${idx})" class="text-red-500 text-sm" aria-label="Supprimer">‚úï</button>
            </div>
            <div class="flex justify-between items-center">
              <div class="flex items-center gap-2">
                <button type="button" onclick="updateCartQuantity(${idx}, ${item.quantity - 1})" class="w-6 h-6 rounded border text-sm">-</button>
                <span class="text-sm">${item.quantity}</span>
                <button type="button" onclick="updateCartQuantity(${idx}, ${item.quantity + 1})" class="w-6 h-6 rounded border text-sm">+</button>
              </div>
              <span class="font-semibold">${money(itemTotal)}</span>
            </div>
          </div>`;
      }).join('');
      $('#cartTotal').textContent = money(total);
      updateCartUI();
    }

// Task 4: Updated sendWhatsAppOrder without location selection
function sendWhatsAppOrder(){
      const loc = DATA.locations[0]; // Single location

      // Read service mode (Sur place / Livraison / En voiture)
      const serviceMode = document.querySelector('input[name="serviceMode"]:checked')?.value || 'Livraison';

      const lines = [];
      lines.push(' *Nouvelle commande Qaouti House*');
      lines.push('');
      lines.push(` *Restaurant:* ${loc.name}`);
      lines.push(` *Mode de service:* ${serviceMode}`);
      lines.push(` *Date:* ${new Date().toLocaleString('fr-FR')}`);
      lines.push('');
      lines.push(' *D√©tails de la commande:*');

      let total = 0;
      cart.forEach((item, i)=>{
        const itemTotal = item.price * item.quantity; total += itemTotal;
        lines.push('');
        lines.push(`${i+1}. *${item.name}* (${item.section})`);
        if(item.selectedOptions){
          Object.entries(item.selectedOptions).forEach(([k,v])=>{
            if(v && v!==''){
              const displayValue = Array.isArray(v) ? v.join(', ') : v;
              lines.push(`   ‚Ä¢ ${k}: ${displayValue}`);
            }
          });
        }
        lines.push(`   ‚Ä¢ Quantit√©: ${item.quantity}`);
        lines.push(`   ‚Ä¢ Prix unitaire: ${money(item.price)}`);
        lines.push(`   ‚Ä¢ Sous-total: ${money(itemTotal)}`);
      });

      lines.push('');
      lines.push(` *Total: ${money(total)}*`);
      lines.push('');
      lines.push('Merci pour votre commande! ');

      const text = lines.join('\n');
      const phone = (loc.phone || '').replace(/[^\d]/g, '');
      const whatsappUrl = `https://wa.me/${phone}?text=${encodeURIComponent(text)}`;
      window.open(whatsappUrl, '_blank');
    }

    // ====== Add-to-cart modal ======
    function openAddToCart(item, section){
      currentItem = { ...item, section: section.name, _sectionRef: section };
      currentQuantity = 1;
      $('#addToCartTitle').textContent = item.name;
      $('#quantity').textContent = currentQuantity;
      renderAddToCartOptions(item, section);
      $('#addToCartModal').showModal();
    }
    function closeAddToCart(){ $('#addToCartModal').close(); currentItem = null; }
    function increaseQuantity(){ currentQuantity++; $('#quantity').textContent = currentQuantity; }
    function decreaseQuantity(){ if(currentQuantity>1){ currentQuantity--; $('#quantity').textContent = currentQuantity; } }
    
    // Handle suggestion quantity updates
    function updateSuggestionQuantity(suggestionId, change) {
      const input = document.getElementById(suggestionId);
      const qtySpan = document.getElementById(suggestionId + '_qty');
      if (!input || !qtySpan) return;
      
      let currentQty = parseInt(input.dataset.quantity || '0');
      currentQty = Math.max(0, currentQty + change);
      
      input.dataset.quantity = currentQty;
      qtySpan.textContent = currentQty;
    }

    function renderAddToCartOptions(item, section){
      const content = $('#addToCartContent'); let html = '';
      if(item.desc){ html += `<p class="text-sm text-slate-600 mb-4">${item.desc}</p>`; }
      
      // Tacos supplements
      if(section.options && section.options.supplements){
        html += `<div class="mb-4"><span class="block font-medium mb-2">${t('supplements')}:</span>`;
        section.options.supplements.forEach((sup,idx)=>{
          const id=`sup_${idx}`;
          html += `<label for="${id}" class="flex items-center mb-2">
            <input id="${id}" type="checkbox" name="supplements" value="${sup.name}" data-price="${sup.price}" class="mr-2"> ${sup.name} (+${money(sup.price)})
          </label>`;
        });
        html += `</div>`;
      }

      // Suggestions (Jus and Dessert) - only show if main item is NOT from Dessert or Jus categories
      if(section.name !== 'Dessert' && section.name !== 'Jus' && section.options){
        // Jus suggestions with quantity controls
        if(section.options.Jus && Array.isArray(section.options.Jus) && section.options.Jus.length){
          html += `<div class="mb-4">
            <span class="block font-medium mb-2">Suggestions Jus:</span>
            <div class="space-y-2">`;
          section.options.Jus.forEach((jus, idx) => {
            const id = `jus_suggestion_${idx}`;
            html += `
              <div class="flex items-center justify-between border rounded-lg p-3 bg-amber-50">
                <div class="flex-1">
                  <span class="font-medium">${jus.name}</span>
                  <span class="text-sm text-slate-600 ml-2">+${money(jus.price)}</span>
                </div>
                <div class="flex items-center gap-2">
                  <button type="button" onclick="updateSuggestionQuantity('${id}', -1)" class="w-8 h-8 rounded-full border flex items-center justify-center hover:bg-white">-</button>
                  <span id="${id}_qty" class="w-8 text-center font-semibold">0</span>
                  <button type="button" onclick="updateSuggestionQuantity('${id}', 1)" class="w-8 h-8 rounded-full border flex items-center justify-center hover:bg-white">+</button>
                </div>
                <input type="hidden" id="${id}" name="jus_suggestions" value="${jus.name}" data-price="${jus.price}" data-quantity="0">
              </div>`;
          });
          html += `</div></div>`;
        }

        // Dessert suggestions with quantity controls  
        if(section.options.Dessert && Array.isArray(section.options.Dessert) && section.options.Dessert.length){
          html += `<div class="mb-4">
            <span class="block font-medium mb-2">Suggestions Dessert:</span>
            <div class="space-y-2">`;
          section.options.Dessert.forEach((dessert, idx) => {
            const id = `dessert_suggestion_${idx}`;
            html += `
              <div class="flex items-center justify-between border rounded-lg p-3 bg-amber-50">
                <div class="flex-1">
                  <span class="font-medium">${dessert.name}</span>
                  <span class="text-sm text-slate-600 ml-2">+${money(dessert.price)}</span>
                </div>
                <div class="flex items-center gap-2">
                  <button type="button" onclick="updateSuggestionQuantity('${id}', -1)" class="w-8 h-8 rounded-full border flex items-center justify-center hover:bg-white">-</button>
                  <span id="${id}_qty" class="w-8 text-center font-semibold">0</span>
                  <button type="button" onclick="updateSuggestionQuantity('${id}', 1)" class="w-8 h-8 rounded-full border flex items-center justify-center hover:bg-white">+</button>
                </div>
                <input type="hidden" id="${id}" name="dessert_suggestions" value="${dessert.name}" data-price="${dessert.price}" data-quantity="0">
              </div>`;
          });
          html += `</div></div>`;
        }
      }
      
      content.innerHTML = html;
    }

    // Add to cart with validations
    function addToCart(){
      if(!currentItem) return;
      const selectedOptions = {}; 
      let basePrice = currentItem.price || 0;

      // Supplements add-on
      const supInputs = Array.from(document.querySelectorAll('input[name="supplements"]:checked'));
      if(supInputs.length){ 
        selectedOptions['Suppl√©ments'] = supInputs.map(i=>i.value); 
        supInputs.forEach(i=> basePrice += parseFloat(i.dataset.price||0)); 
      }

      // Jus suggestions
      const jusSuggestionInputs = Array.from(document.querySelectorAll('input[name="jus_suggestions"]'));
      const selectedJusSuggestions = [];
      jusSuggestionInputs.forEach(input => {
        const qty = parseInt(input.dataset.quantity || '0');
        if (qty > 0) {
          selectedJusSuggestions.push({
            name: input.value,
            quantity: qty,
            price: parseFloat(input.dataset.price || '0')
          });
          basePrice += parseFloat(input.dataset.price || '0') * qty;
        }
      });
      if (selectedJusSuggestions.length) {
        selectedOptions['Jus'] = selectedJusSuggestions;
      }

      // Dessert suggestions
      const dessertSuggestionInputs = Array.from(document.querySelectorAll('input[name="dessert_suggestions"]'));
      const selectedDessertSuggestions = [];
      dessertSuggestionInputs.forEach(input => {
        const qty = parseInt(input.dataset.quantity || '0');
        if (qty > 0) {
          selectedDessertSuggestions.push({
            name: input.value,
            quantity: qty,
            price: parseFloat(input.dataset.price || '0')
          });
          basePrice += parseFloat(input.dataset.price || '0') * qty;
        }
      });
      if (selectedDessertSuggestions.length) {
        selectedOptions['Dessert'] = selectedDessertSuggestions;
      }

      const cartId = generateCartId(currentItem, { name: currentItem.section });
      const existingIndex = cart.findIndex(it => it.cartId===cartId && JSON.stringify(it.selectedOptions)===JSON.stringify(selectedOptions));
      if(existingIndex>=0){ cart[existingIndex].quantity += currentQuantity; } else {
        cart.push({ cartId, name: currentItem.name, section: currentItem.section, price: basePrice, quantity: currentQuantity, selectedOptions });
      }
      saveCart(); closeAddToCart();
      showToast('Ajout√© avec succ√®s', 'ok');
    }

    // ====== Image helpers (use IMAGE_CFG and item.image override) ======
    function menuImageTag(item, sectionName, altText){
      const sectionImg = IMAGE_CFG.categories[sectionName] || '';
      const sectionFallback = IMAGE_CFG.fallbacks.categories[sectionName] || IMAGE_CFG.fallbacks.categories['Plats'];
      const primary = (item && item.image && String(item.image).trim()) ? item.image : sectionImg;
      const src = primary || sectionFallback;
      const alt = altText || item?.name || sectionName;
      return `<img src="${src}" onerror="this.onerror=null; this.src='${sectionFallback}'" alt="${alt}" class="card-img" loading="lazy" decoding="async">`;
    }
    function locationImageTag(loc){
      const src = (loc.image && String(loc.image).trim()) ? loc.image : IMAGE_CFG.fallbacks.location;
      return `<img src="${src}" onerror="this.onerror=null; this.src='${IMAGE_CFG.fallbacks.location}'" alt="${loc.name}" class="w-full aspect-square object-cover rounded-xl mb-4" loading="lazy" decoding="async">`;
    }
    function categoryImageTag(sectionName){
      const src = IMAGE_CFG.categories[sectionName] || '';
      const fallback = IMAGE_CFG.fallbacks.categories[sectionName] || IMAGE_CFG.fallbacks.categories['Plats'];
      const alt = sectionName;
      return `<img src="${src || fallback}" onerror="this.onerror=null; this.src='${fallback}'" alt="${alt}" class="w-full h-full object-cover rounded-xl" loading="lazy" decoding="async">`;
    }

    // ====== Renderers ======
    function renderHero(){
      // Taglines
      $('#tagline').textContent = LANG==='fr' ? DATA.brand.tagline_fr : LANG==='en' ? DATA.brand.tagline_en : DATA.brand.tagline_ar;
      $('#taglineSmall').textContent = $('#tagline').textContent;
      // Images from IMAGE_CFG
      const brand = $('#brandLogo'); if(brand){ brand.src = IMAGE_CFG.brand.logo; }
      const heroLogo = $('#heroLogoImage'); if(heroLogo){ heroLogo.src = IMAGE_CFG.brand.hero_logo; }
      const heroBg = $('#heroBgImage'); if(heroBg){ heroBg.src = IMAGE_CFG.hero.bg; }
    }

    function renderPopular(){
      const wrap = $('#popularList'); wrap.innerHTML='';
      const platsSection = DATA.menu.sections.find(s => s.name === 'Plats');
      if(!platsSection) return;
      const items = platsSection.items.slice(0,6);
      items.forEach(it => {
        const div = document.createElement('div');
        div.className = 'min-w-[300px] border bg-white rounded-2xl p-4 shadow-soft';
        div.innerHTML = `
          ${menuImageTag(it, platsSection.name, it.name)}
          <div class="text-sm text-slate-500 mb-1">${platsSection.name}</div>
          <div class="font-semibold">${it.name}</div>
          <div class="mt-2 text-sm">${money(it.price)}</div>
          <button type="button" class='mt-3 px-3 py-1.5 rounded-lg bg-[color:var(--primary)] text-[color:var(--primary-ink)] text-sm font-semibold ring-soft'
                  data-i18n='add_to_cart'>${t('add_to_cart')}</button>`;
        div.querySelector('button').addEventListener('click', ()=> openAddToCart(it, platsSection));
        wrap.appendChild(div);
      });
    }

// helper: full-bleed image for a category
function categoryImageTag(sectionName){
  const primary = IMAGE_CFG.categories[sectionName] || '';
  const fallback = IMAGE_CFG.fallbacks.categories[sectionName] || IMAGE_CFG.fallbacks.categories['Plats'];
  const src = primary || fallback;
  return `<img src="${src}" onerror="this.onerror=null; this.src='${fallback}'"
              alt="${sectionName}" class="absolute inset-0 w-full h-full object-cover" loading="lazy" decoding="async">`;
}

function renderMenu(){
  const tabs = $('#menuTabs');
  const content = $('#menuContent');
  tabs.innerHTML = '';
  content.innerHTML = '';

  // Make #menuTabs a horizontal scroller on mobile, grid on desktop
  tabs.className = [
    'flex gap-3 overflow-x-auto no-scrollbar snap-x snap-mandatory py-2 -mx-4 px-4',
    'md:grid md:grid-cols-6 md:gap-4 md:overflow-visible md:snap-none md:mx-0'
  ].join(' ');

  // Build image cards
  DATA.menu.sections.forEach((section, idx)=>{
    const card = document.createElement('button');
    card.type = 'button';
    card.className = `
      relative shrink-0 w-[120px] h-[120px] md:w-40 md:h-40
      rounded-3xl overflow-hidden ring-2 ring-transparent
      transition-transform duration-200 hover:scale-105 hover:shadow-lg
      snap-start focus:outline-none
    `;
    card.setAttribute('aria-label', section.name);

    card.innerHTML = `
      ${categoryImageTag(section.name)}
      <div class="absolute inset-0 bg-black/40 flex items-center justify-center">
        <span class="text-white font-extrabold tracking-tight kaushan-script-regular 
             text-center text-xl md:text-3xl px-2 leading-tight">
          ${section.name}
        </span>
      </div>
    `;

    card.addEventListener('click', ()=> showSection(idx));
    tabs.appendChild(card);
  });

  showSection(0);

  function setActive(i){
    $$('#menuTabs > *').forEach((el, idx)=>{
      el.classList.toggle('ring-[color:var(--primary)]', idx === i);
      el.classList.add('ring-2'); // ensure ring is visible
    });
  }

  function showSection(i){
    content.innerHTML = '';
    setActive(i);

    const s = DATA.menu.sections[i];

    if (s.desc){
      const note = document.createElement('div');
      note.className = 'md:col-span-2 mb-2 text-sm text-slate-600';
      note.textContent = s.desc;
      content.appendChild(note);
    }

    if (s.items){
      s.items.forEach(item => content.appendChild(renderItemCard(item, s)));
    }

    if (s.subsections){
      s.subsections.forEach(sub=>{
        const hd = document.createElement('h4');
        hd.className = 'md:col-span-2 text-lg font-bold mt-4';
        hd.textContent = sub.name;
        content.appendChild(hd);

        if (sub.desc){
          const d = document.createElement('p');
          d.className = 'md:col-span-2 text-sm text-slate-600 mb-2';
          d.textContent = sub.desc;
          content.appendChild(d);
        }

        (sub.variants || []).forEach(v => content.appendChild(renderItemCard(v, s)));
      });
    }
  }
}


    function renderItemCard(item, section){
      const card = document.createElement('div');
      card.className = 'border rounded-2xl p-4 bg-white shadow-soft';
      const imgWrap = document.createElement('div');
      imgWrap.innerHTML = menuImageTag(item, section.name, item.name);
      const title = document.createElement('div');
      title.className = 'font-semibold'; title.textContent = item.name;
      const desc = document.createElement('div');
      desc.className = 'text-sm text-slate-600 mt-1'; desc.textContent = item.desc||'';
      const price = document.createElement('div');
      price.className = 'mt-2 text-sm flex flex-wrap gap-2';
      if(item.prices){
        price.innerHTML = Object.entries(item.prices).map(([k,v])=>`<span class='px-2 py-1 rounded-full bg-slate-100 border'>${k}: ${money(v)}</span>`).join('');
      } else if(Array.isArray(item.variants) && item.variants.length){
        price.innerHTML = item.variants.map(v=>`<span class='px-2 py-1 rounded-full bg-slate-100 border'>${v.name}: ${money(v.price)}</span>`).join('');
      } else if(item.price!=null){ 
        price.textContent = money(item.price); 
      }
      const ctas = document.createElement('div'); ctas.className='mt-3 flex gap-2';
      const addBtn = document.createElement('button');
      addBtn.type = "button";
      addBtn.className = 'px-3 py-1.5 rounded-lg bg-[color:var(--primary)] text-[color:var(--primary-ink)] text-sm font-semibold ring-soft';
      addBtn.textContent = t('add_to_cart');
      addBtn.onclick = () => openAddToCart(item, section);
      ctas.appendChild(addBtn);
      card.append(imgWrap, title, desc, price, ctas);
      return card;
    }
      
    function renderLocations(){
      const wrap = $('#locationCards'); wrap.innerHTML='';
      DATA.locations.forEach(loc=>{
        const card = document.createElement('div');
        card.className = 'border rounded-2xl p-4 bg-white text-black shadow-soft';
        const hours = Object.entries(loc.hours).map(([d,h])=>`<li class='flex justify-between'><span class='capitalize'>${d}</span><span>${h}</span></li>`).join('');
        card.innerHTML = `
          ${locationImageTag(loc)}
          <h4 class="text-lg font-bold">${loc.name}</h4>
          <p class="text-sm text-slate-700">${loc.address}</p>
          <div class="mt-3 flex flex-wrap gap-2">
            <a href="https://g.page/r/CW_BpVVWMto0EBE/review" target="_blank" rel="noopener" class="px-3 py-1.5 rounded-lg font-semibold text-sm" style="background-color: var(--accent-review); color: white;">Laisser un avis</a>
            <a class="px-3 py-1.5 rounded-lg bg-slate-900 text-white text-sm" href="tel:${loc.phone}">${t('call')}</a>
            <a class="px-3 py-1.5 rounded-lg bg-emerald-600 text-white text-sm" href="${loc.whatsapp}" target="_blank" rel="noopener noreferrer">WhatsApp</a>
            <a class="px-3 py-1.5 rounded-lg bg-blue-600 text-white text-sm" href="${loc.maps_url}" target="_blank" rel="noopener noreferrer">${t('directions')}</a>
            <a class="px-3 py-1.5 rounded-lg font-semibold text-sm" style="background-color: var(--accent-glovo); color: var(--ink);" href="${loc.glovo_url}" target="_blank" rel="noopener noreferrer">${t('order_glovo')}</a>
          </div>
          <h5 class="mt-4 font-semibold">${t('hours')}</h5>
          <ul class="mt-1 space-y-1 text-sm">${hours}</ul>
          <p class="mt-3 text-xs text-slate-600">Esp√®ces ¬∑ Paiement √† la livraison ¬∑ Cartes de cr√©dit ¬∑ Cartes de d√©bit ¬∑ NFC</p>`;
        wrap.appendChild(card);
      });
    }

    function injectJSONLD(){
      DATA.locations.forEach(loc=>{
        const spec = [
          { dayOfWeek:'Monday', opens:loc.hours.lundi?.split('‚Äì')[0]?.replace('.',':')||'11:00', closes:loc.hours.lundi?.split('‚Äì')[1]||'00:45' },
          { dayOfWeek:'Tuesday', opens:loc.hours.mardi?.split('‚Äì')[0]||'11:00', closes:loc.hours.mardi?.split('‚Äì')[1]||'00:45' },
          { dayOfWeek:'Wednesday', opens:loc.hours.mercredi?.split('‚Äì')[0]||'11:00', closes:loc.hours.mercredi?.split('‚Äì')[1]||'00:45' },
          { dayOfWeek:'Thursday', opens:loc.hours.jeudi?.split('‚Äì')[0]||'11:00', closes:loc.hours.jeudi?.split('‚Äì')[1]||'00:45' },
          { dayOfWeek:'Friday', opens:loc.hours.vendredi?.split('‚Äì')[0]||'11:00', closes:loc.hours.vendredi?.split('‚Äì')[1]||'00:45' },
          { dayOfWeek:'Saturday', opens:loc.hours.samedi?.split('‚Äì')[0]||'11:00', closes:loc.hours.samedi?.split('‚Äì')[1]||'00:30' },
          { dayOfWeek:'Sunday', opens:loc.hours.dimanche?.split('‚Äì')[0]||'11:00', closes:loc.hours.dimanche?.split('‚Äì')[1]||'00:45' }
        ].map(x=>({"@type":"OpeningHoursSpecification", dayOfWeek:x.dayOfWeek, opens:x.opens, closes:x.closes }));
        const json = {
          "@context":"https://schema.org",
          "@type":"Restaurant",
          name: loc.name,
          telephone: loc.phone,
          servesCuisine: ["Caf√©","Restaurant","P√¢tisserie"],
          address: { "@type":"PostalAddress", streetAddress: loc.address.split(',')[0], addressLocality: "Rabat", postalCode: loc.address.match(/\b\d{5}\b|\b\d{4,5}\b/)?.[0]||"10052", addressCountry: "MA" },
          areaServed: "Rabat",
          sameAs: [ "https://www.instagram.com/qaoutihouse/?hl=fr" ],
          hasMap: loc.maps_url,
          openingHoursSpecification: spec,
          potentialAction: { "@type":"OrderAction", target: { "@type":"EntryPoint", urlTemplate: loc.glovo_url }},
          paymentAccepted: ["Cash","Cash on Delivery","Credit Card","Debit Card","NFC Mobile"],
          priceRange: DATA.menu.currency
        };
        const s = document.createElement('script'); s.type = 'application/ld+json'; s.textContent = JSON.stringify(json); document.head.appendChild(s);
      });
    }

    function openGlovoChooser(){
      const dlg = $('#glovoModal');
      const wrap = $('#glovoChoices'); wrap.innerHTML = '';
      DATA.locations.forEach(loc=>{
        const btn = document.createElement('button');
        btn.type="button";
        btn.className = 'w-full px-3 py-2 rounded-lg border bg-white hover:bg-amber-50 text-left';
        btn.innerHTML = `<div class="font-semibold">${loc.name}</div><div class="text-sm text-slate-600">${loc.address}</div>`;
        btn.onclick = ()=>{ window.open(loc.glovo_url, '_blank'); dlg.close(); try{ localStorage.setItem('qaouti_glovo_loc', loc.id);}catch(e){} };
        wrap.appendChild(btn);
      });
      dlg.showModal();
    }

    function renderAll(){
      document.getElementById('year').textContent = new Date().getFullYear();
      renderHero(); renderPopular(); renderMenu(); renderLocations();
      $$('[data-i18n]').forEach(el => { const key = el.getAttribute('data-i18n'); el.textContent = t(key); });
      updateCartUI();
    }

    document.addEventListener('keydown', (e)=>{
      if(e.key==='Escape'){
        ['cartModal','addToCartModal','glovoModal'].forEach(id=>{ const d = document.getElementById(id); if(d && d.open) d.close(); });
      }
    });

    ['cartModal','addToCartModal'].forEach(id=>{
      const d = document.getElementById(id);
      d?.addEventListener('close', ()=>{ document.activeElement && document.activeElement.blur(); });
    });

    document.addEventListener('DOMContentLoaded', () => {
      try{ LANG = localStorage.getItem('qaouti_lang') || LANG; }catch(e){}
      applyHtmlLangDir();
      $('#floatingCartBtn').addEventListener('click', openCart);
      $('#heroGlovo').addEventListener('click', openGlovoChooser);
      $('#heroCallBtn').addEventListener('click', () => window.location.href = `tel:${DATA.locations[0].phone}`);
      $('#heroWhatsAppBtn').addEventListener('click', () => window.open(DATA.locations[0].whatsapp, '_blank'));
      renderAll(); injectJSONLD();
    });
  </script>
</body>
</html>